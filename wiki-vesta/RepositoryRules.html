<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>RepositoryRules - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: RepositoryRules" href="RepositoryRules%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=RepositoryRules&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="RepositoryRules%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="RepositoryRules%3Faction=print.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="RepositoryRules.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="RepositoryRules.html">RepositoryRules</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="RepositoryRules.html">RepositoryRules</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="RepositoryRules%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Repository_Filesystem_Rules">Repository Filesystem Rules</h1>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">The repository is a virtual filesystem.  You mount it using an NFS client.  You can browse it and perform operations within it from the command line or using any other filesystem tools.  However, it has certain rules that it enforces. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
<h2 id="Roots">Roots</h2>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">The repository root (also called &quot;the appendable root&quot;) is normally mounted as &quot;<tt>/vesta</tt>&quot;.  In fact, &quot;<tt>/vesta</tt>&quot; is used in all <em>canonical names</em> for objects in the repository.  (Mostly those are the names printed by tools like <tt>vcheckout</tt> and stored in attributes like <tt>old-version</tt>.) <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">The mutable root is normally mounted as &quot;<tt>/vesta-work</tt>&quot; (which is also its canonical name). <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">There is a third root called the volatile root, which is normally mounted as &quot;<tt>/vesta-work/.volatile</tt>&quot;.  This is where the temporary directories used during builds exist.  Users almost never interact directly with anything in the volatile root. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h2 id="Object_Types">Object Types</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">Objects in the repository have <em>types</em>, which can't be represented through the filesystem interface.  For example, there are several different types of directories, but there's no way to tell the difference between them using the filesystem interface. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">To get information on an object's type, use <tt>vattrib</tt>. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Appendable_Directories">Appendable Directories</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">The repository root is an <em>appendable directory</em>.  Many directories you find below it are also appendable directories.  Packages are appendable directories.  (The repository tools treat packages differently from other appendable directories, but only because of their attributes.) <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">Appendable directories have several rules: <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><ul><li>Once you create something with a particular name in an appendable directory, you can't get rid of that name. <span class="anchor" id="line-30"></span></li><li><p class="line862">If you delete something in a master appendable directory, it will leave behind a <em>ghost</em> <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span></li></ul><p class="line874">Appendable directories can contain: <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><ul><li>Appendable directories <span class="anchor" id="line-35"></span></li><li>Immutable directories <span class="anchor" id="line-36"></span></li><li>Stubs <span class="anchor" id="line-37"></span></li><li>Ghosts <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></li></ul><p class="line874">Theoretically, an immutable file could be placed directly in an appendable directory (i.e. versioning a file rather than a directory).  No tools exist to do this, but one could be written. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">To support Vesta's <em>partial replication</em> feature, there are two kinds of appendable directory, <em>master</em> and <em>nonmaster</em>.  Each appendable directory can have its master replica in only one repository, but there can be nonmaster replicas in many other repositories.  All the replicas have the same canonical name.  A directory's master replica must contain every name that exists in any of the directory's replicas, but a nonmaster replica often doesn't contain all the names that exist in the master replica.  In any replica (including the master), some of the names may be bound to ghosts or stubs even if they are bound to something else in other replicas. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">Inside a master appendable directory you can: <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><ul><li><p class="line862">Use <tt>mkdir</tt> or <tt>vmkdir</tt> to create a new master appendable directory. <span class="anchor" id="line-46"></span></li><li><p class="line862">Remove an existing object with <tt>rm</tt>, <tt>rmdir</tt>, or <tt>vrm</tt> and leave behind a ghost.  (This operation is usually restricted to administrators.) <span class="anchor" id="line-47"></span></li><li><p class="line862">Change permissions with <tt>chmod</tt>, <tt>chown</tt>, and <tt>chgrp</tt>. <span class="anchor" id="line-48"></span></li><li>Create a stub or immutable directory using one of the repository tools. <span class="anchor" id="line-49"></span></li><li><p class="line862">Use <tt>vrepl</tt> to replicate in content from another repository.  Note that doing this replaces a stub or ghost, because of the rule that the master always contains all names. <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span></li></ul><p class="line874">Inside a nonmaster appendable directory you can: <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><ul><li><p class="line862">Use <tt>vrepl</tt> to replicate in content from another repository. <span class="anchor" id="line-54"></span></li><li><p class="line862">Remove an existing object with <tt>rm</tt>, <tt>rmdir</tt>, or <tt>vrm</tt> and leave behind a ghost. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></li></ul><p class="line874">Inside an appendable directory you cannot: <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><ul><li>Create a file through the NFS interface.  (Theoretically you could add an immutable file to a master appendable directory using the repository's API.) <span class="anchor" id="line-59"></span></li><li>Rename an existing object. <span class="anchor" id="line-60"></span></li><li>Reuse a name that has existed before.  (Ghosts prevent this) <span class="anchor" id="line-61"></span></li><li>Directly create a symlink (but see under Stubs below) <span class="anchor" id="line-62"></span></li><li>Create a hard link <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span></li></ul><p class="line867">
<h2 id="Immutable_Directories">Immutable Directories</h2>
<span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">An immutable directory is a directory whose contents cannot be changed.  The versions in a package or session are immutable directories.  They are normally <span class="anchor" id="line-67"></span>created with <tt>vcheckin</tt> or <tt>vadvance</tt>. <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line874">Immutable directories can contain: <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><ul><li>Immutable files <span class="anchor" id="line-72"></span></li><li>Immutable directories <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></li></ul><p class="line867">
<h2 id="Stubs">Stubs</h2>
<span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line874">A stub is a placeholder for an object that doesn't exist yet or doesn't exist here. <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867"><em>Master</em> stubs are version reservations created by <tt>vcheckout</tt>.  A master stub can be replaced with any other object later.  Master stubs are often replaced with immutable directories by <tt>vcheckin</tt>. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line867"><em>Nonmaster</em> stubs are placeholders for objects that don't exist in this repository, but may exist in some other repository.  A nonmaster stub may be replaced later by replicating the object it is standing in for from a repository that has a copy. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line862">Stubs can also be used to create symbolic links.  A stub with a <tt>symlink-to</tt> attribute will be appear as a symbolic link in the filesystem interface.  The <tt>latest</tt> symlink in a package is a stub.   Because a symlink's value is mutable, symlinks aren't visible to the Vesta evaluator; they are only a convenience feature for users browsing the repository. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line874">A stub can exist only in an appendable directory. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line867">
<h2 id="Ghosts">Ghosts</h2>
<span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line862">A ghost is a placeholder for a name that used to exist, to prevent it from being reused in the future with a different meaning.  Ghosts are created by deleting an existing object from an appendable directory, typically with <tt>rm</tt>, <tt>rmdir</tt>, or <tt>vrm</tt>. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line862">You can revive a ghost by replicating in a copy of the object that its name used to belong to from another repository, using <tt>vrepl&nbsp;-r</tt>.  Without the <tt>-r</tt> flag, <tt>vrepl</tt> assumes you want the ghost to stay dead. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line874">A ghost can exist only in an appendable directory. <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line867">
<h2 id="Mutable_Directories">Mutable Directories</h2>
<span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line862">Mutable directories can be changed arbitrarily.  They don't have the kind of restrictions that appendable and immutable directories have.  Mutable directories are found only under the mutable root (<tt>/vesta-work</tt>). <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line862">The working copies created by <tt>vcheckout</tt> for editing are mutable directories.  Each user's directory containing their working copies (<tt>/vesta-work/jsmith</tt>) is a mutable directory. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line874">Inside a mutable directory you can: <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><ul><li>Create, delete, and rename files and directories <span class="anchor" id="line-103"></span></li><li>Modify files <span class="anchor" id="line-104"></span></li><li><p class="line862">Change permissions with <tt>chmod</tt>, <tt>chown</tt>, and <tt>chgrp</tt> <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li></ul><p class="line874">Inside a mutable directory you cannot: <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><ul><li>Create symbolic links (at least not currently) <span class="anchor" id="line-109"></span></li><li>Create hard links <span class="anchor" id="line-110"></span></li><li>Create appendable directories, immutable directories, ghosts, or stubs <span class="anchor" id="line-111"></span></li></ul><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

