<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>MergingFuture/Food4Thought/HistoryManagement - Vesta Wiki</title>
<script type="text/javascript" src="../../moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../../moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../../moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../../moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../../moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../../moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: MergingFuture/Food4Thought/HistoryManagement" href="HistoryManagement%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=MergingFuture%252FFood4Thought%252FHistoryManagement&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="HistoryManagement%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="HistoryManagement%3Faction=print.html">
<link rel="Up" href="../Food4Thought.html">
<link rel="Appendix" title="autogenerated-060ed29a05aab85c2a298e24caa4233983b0091a.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-060ed29a05aab85c2a298e24caa4233983b0091a.png.html">
<link rel="Appendix" title="autogenerated-0c579e16774ca9e42bb7a0e279ce56b352f04ce7.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-0c579e16774ca9e42bb7a0e279ce56b352f04ce7.png.html">
<link rel="Appendix" title="autogenerated-217575c49b46dfa549deedec85ef8048ba8530ed.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-217575c49b46dfa549deedec85ef8048ba8530ed.png.html">
<link rel="Appendix" title="autogenerated-3c1837931e2e5c2f94b3cc1a17ab9f816b992234.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-3c1837931e2e5c2f94b3cc1a17ab9f816b992234.png.html">
<link rel="Appendix" title="autogenerated-40e777bbfd8d3ded69f59275ab6cc14a305c5cd4.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-40e777bbfd8d3ded69f59275ab6cc14a305c5cd4.png.html">
<link rel="Appendix" title="autogenerated-4fbf0ba2aea81a6f79036954dca1031c14be9ec2.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-4fbf0ba2aea81a6f79036954dca1031c14be9ec2.png.html">
<link rel="Appendix" title="autogenerated-52eb6c9af0263cf115f18325e1e321395594e924.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-52eb6c9af0263cf115f18325e1e321395594e924.png.html">
<link rel="Appendix" title="autogenerated-55538bdb06c4db30b97e4c59c79f8202b9d91a0d.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-55538bdb06c4db30b97e4c59c79f8202b9d91a0d.png.html">
<link rel="Appendix" title="autogenerated-606f8f5332d7ab50e0a13a7abd13bce9ae6b37b1.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-606f8f5332d7ab50e0a13a7abd13bce9ae6b37b1.png.html">
<link rel="Appendix" title="autogenerated-79b8a75c8620177412f65a05b54771bac6270041.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-79b8a75c8620177412f65a05b54771bac6270041.png.html">
<link rel="Appendix" title="autogenerated-79ecc68e23b38e18f3ef5ffb5f3d56e9d21db558.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-79ecc68e23b38e18f3ef5ffb5f3d56e9d21db558.png.html">
<link rel="Appendix" title="autogenerated-82b24b1bb34a6e3a98b66ab0c2f40f9d25686e59.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-82b24b1bb34a6e3a98b66ab0c2f40f9d25686e59.png.html">
<link rel="Appendix" title="autogenerated-84004cd6aafec0206631fb1a69295bd6ae4b56ed.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-84004cd6aafec0206631fb1a69295bd6ae4b56ed.png.html">
<link rel="Appendix" title="autogenerated-87943f94f046a9f71a1909a62b8799e0208575b9.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-87943f94f046a9f71a1909a62b8799e0208575b9.png.html">
<link rel="Appendix" title="autogenerated-a23090de1ef90429ae41a36ba874f879c7c26c5e.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-a23090de1ef90429ae41a36ba874f879c7c26c5e.png.html">
<link rel="Appendix" title="autogenerated-a3b3d8fbd250730fae8dda90d4a4aca34f65a05a.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-a3b3d8fbd250730fae8dda90d4a4aca34f65a05a.png.html">
<link rel="Appendix" title="autogenerated-a91a64bd356046ac4f5dedb120d305d23ac96834.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-a91a64bd356046ac4f5dedb120d305d23ac96834.png.html">
<link rel="Appendix" title="autogenerated-bd72cdeeff26e9efb5162596916051047a4e0edf.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-bd72cdeeff26e9efb5162596916051047a4e0edf.png.html">
<link rel="Appendix" title="autogenerated-be656e5dcb219071b343f33f3b794c3dc97cc6d9.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-be656e5dcb219071b343f33f3b794c3dc97cc6d9.png.html">
<link rel="Appendix" title="autogenerated-c46788c33abc422c553c38b5771f2df2418bc80c.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-c46788c33abc422c553c38b5771f2df2418bc80c.png.html">
<link rel="Appendix" title="autogenerated-d10148687c4b4241efa6c5f26026763b8fc163c8.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-d10148687c4b4241efa6c5f26026763b8fc163c8.png.html">
<link rel="Appendix" title="autogenerated-d6d174517026e00d6431e6c4a5a888ded8f8790e.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-d6d174517026e00d6431e6c4a5a888ded8f8790e.png.html">
<link rel="Appendix" title="autogenerated-f332d2fa387394c6bb6f8eeab523b226d21869e5.png" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-f332d2fa387394c6bb6f8eeab523b226d21869e5.png.html">
<link rel="Appendix" title="delete.me.to.regenerate.images" href="HistoryManagement%3Faction=AttachFile&amp;do=view&amp;target=delete.me.to.regenerate.images.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="HistoryManagement.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="MergingFuture.html">MergingFuture</a></li><li><a href="../Food4Thought.html">Food4Thought</a></li><li><a href="HistoryManagement.html">HistoryManagement</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="HistoryManagement.html">HistoryManagement</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="HistoryManagement%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="HistoryManagement.html#A_Motivating_Example">A Motivating Example</a></li><li>
<a href="HistoryManagement.html#Merging_Needs_Accurate_Historical_Records">Merging Needs Accurate Historical Records</a><ol><li>
<a href="HistoryManagement.html#Problems_In_Vesta">Problems In Vesta</a></li><li>
<a href="HistoryManagement.html#Partial_Replication_vs._Ancestry">Partial Replication vs. Ancestry</a><ol><li>
<a href="HistoryManagement.html#Always_Replicate_Ancestry.3F">Always Replicate Ancestry?</a></li><li>
<a href="HistoryManagement.html#Partial_History.2C_or_All_History.3F">Partial History, or All History?</a></li></ol></li><li>
<a href="HistoryManagement.html#Relationship_to_File.2FDirectory_Rename.2FIdentity_Tracking">Relationship to File/Directory Rename/Identity Tracking</a></li></ol></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">
<h1 id="A_Motivating_Example">A Motivating Example</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">Suppose Jill replicates <tt>/vesta/example.com/foo/10</tt> from the main project repository.  She disconnects from the network and wants to make some changes locally so she creates a foreign checkout: <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867"><span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><pre><span class="anchor" id="line-1"></span>% vcheckout -F /vesta/example.com/foo
<span class="anchor" id="line-2"></span>Creating session /vesta/jill.example.com/example.com/foo/checkout/10.jill_jlaptop.example.com.1
<span class="anchor" id="line-3"></span>Making working directory /vesta-work/jill/foo</pre><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line874">She makes some changes and takes a few snapshots as she works, until she's satisfied with her work: <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line867"><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><pre><span class="anchor" id="line-1-1"></span>...
<span class="anchor" id="line-2-1"></span>% vadvance /vesta-work/jill/foo
<span class="anchor" id="line-3-1"></span>Advancing to /vesta/jill.example.com/example.com/foo/checkout/10.jill_jlaptop.example.com.1/7</pre><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">In the mean time, someone else has checked in <tt>/vesta/example.com/foo/11</tt>. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line862">Now Jill wants to push her changes back into the mainline, so she does a merge operation and checks in the result of the merge as <tt>/vesta/example.com/foo/12</tt>. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line862">What if someone wants to see where the change in <tt>foo/12</tt> originated from?  What if Jill doesn't replicate her change back to the main repository?  She might not even have permission to do so.  We know her laptop repository may not be accessible on the network.  Is the only way to get at the original change to send Jill an e-mail and hope she's around? <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">Even if she has replicated her snapshot to the main repository, how do you find it?  Is there an attribute on <tt>foo/12</tt> to tell you what was merged to create it, or do we simply rely on Jill to mention that in the checkin comment? <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">Why is these interesting questions?  Suppose there was more significant development in the disconnected repository before Jill re-connected and merged.  Suppose <tt>foo/12</tt> is broken in some way, but Jill's original change isn't.  It could be important to look at the two parallel changes prior to the merge operation. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><em>(This example is based on <a class="http" href="http://www.scooter.cx/~mozbot/%23revctrl-20050707-070001.xml#njs:2005-07-07T00:04:08Z">some discussion on the #revctrl IRC channel</a>.)</em> <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867">
<h1 id="Merging_Needs_Accurate_Historical_Records">Merging Needs Accurate Historical Records</h1>
<span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line874">Historical records are required by all but the most rudimentary merging algorithms. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line874">There is a method called 2-way merge which can work from simply two different states.  However this requires manual resolution of any differences between the two states, which is very labor intensive for users.  It is not considered very useful. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line862">A method called <a class="interwiki" href="http://revctrl.org/ThreeWayMerge" title="Revctrl">ThreeWayMerge</a> merge has been in use for a long time in systmes like RCS, CVS, and others.  It involves finding a <em>common ancestor</em> and comparing the files on both sides to that common ancestor.  This requires traversing history backwards from the two versions to be merged to find the common ancestor. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line862">Unfortunately, <a class="interwiki" href="http://revctrl.org/ThreeWayMerge" title="Revctrl">ThreeWayMerge</a> merge only works acceptably in extremely limited and disiplined cases of branching and merging.  Any one of a number of fairly simple and reasonable merge sitations (repeated merges, <a class="interwiki" href="http://revctrl.org/CrissCrossMerge" title="Revctrl">CrissCrossMerge</a>, etc.) can cause <a class="interwiki" href="http://revctrl.org/ThreeWayMerge" title="Revctrl">ThreeWayMerge</a> merge to either force the user to do more manual resolution of conflictst or even do the the wrong thing (silently discarding changes in some cases). <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">More advanced textual merging algorithms such as <a class="interwiki" href="http://revctrl.org/PreciseCodevilleMerge" title="Revctrl">PreciseCodevilleMerge</a> (which we've actually prototyped in Vesta) require the entire history back to not just <strong>any</strong> common ancestor, but the common ancestor through which all ancestry paths lead (which some people call a <em>dominator</em>). <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-606f8f5332d7ab50e0a13a7abd13bce9ae6b37b1.png" /><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">In this history, any of <strong>A</strong>, <strong>B</strong>, or <strong>E</strong> could be considered a common ancestor of <strong>D</strong> and <strong>G</strong>.  However only <strong>A</strong> is a dominator.  A merge algorithm like <a class="interwiki" href="http://revctrl.org/PreciseCodevilleMerge" title="Revctrl">PreciseCodevilleMerge</a> would need the file contents at every node in this entire sub-graph to merge <strong>D</strong> and <strong>G</strong>. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line862">Note that the records needed by such advanced merge algorithms must also include records of when previous merges were performed.  A version combining two sets of changes (<strong>C</strong> or <strong>F</strong> above) has both parent versions recorded. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867">
<h2 id="Problems_In_Vesta">Problems In Vesta</h2>
<span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line874">Unfortunately, Vesta does not currently maintain historical records which are either accurate or complete enough to support advanced textual merging.  Vesta really only guarantees to keep immutable copies of individual points in history.  This stems from the design focus on consistent and repeatable builds, which requires an immutable store of individual states but not records about how they came about. <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">There are several problems we will need to address in Vesta to support advanced merging: <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><ul><li><p class="line862">Vesta's <a class="http" href="../../../vesta/doc/man/html/vrepl.1.html#Vesta_Replication">replication design</a> explicitly allows a repository to contain a fragmented history.  For example, from the graph above a repository might contain only versions <strong>A</strong>, <strong>E</strong>, <strong>C</strong>, and <strong>G</strong>.  The other versions might be available from another replica somewhere on the network, or they might not.  Even if all those versions were in packages/branches mastered in one repository, that repository is only required to know the set of names that exist (<strong>A</strong> through <strong>G</strong>), not to know their contents. <span class="anchor" id="line-69"></span></li><li><p class="line862">The record of each version's direct ancestor is in a <a class="http" href="../../../vesta/doc/man/html/vesta-intro.1.html#mutable_attributes">mutable attribute</a> set by <a class="http" href="../../../vesta/doc/man/html/vcheckin.1.html">vcheckin</a>.  This makes it unreliable, little more than an annotation.  It really needs to be recorded immutably as part of the version. <span class="anchor" id="line-70"></span><ul><li><p class="line862">A version may actually be stored internally as a delta of changes over some previous version.  (See the <tt>deltaOnly</tt> parameter to <tt>VestaSource::list</tt> and <tt>VestaSource::getBase</tt>.)  However this is primarily an internal mechanism for saving space and there's no guarantee that a version is recorded as a delta.  In a replica with a fragmented history each version may be a complete copy with no such base pointer. <span class="anchor" id="line-71"></span></li></ul></li><li>Merges need to be recorded as ancestry.  They need to be recorded just as reliably as the version upon which a hand edit is based. <span class="anchor" id="line-72"></span><ul><li>We could distinguish &quot;merged with&quot; as a distinct relationship from &quot;derived from&quot;, but merge algorithms don't recognize the distinction so it would be purely an annotation for users. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></li></ul></li></ul><p class="line867">
<h2 id="Partial_Replication_vs._Ancestry">Partial Replication vs. Ancestry</h2>
<span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line874">As discussed above, to support merging we need to ensure that we have a complete historical record.  This means that replication will need to understand ancestry and follow it, replicating a complete history graph to each repository. <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line862">For example, suppose repository <strong>X</strong> has a history like this: <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line867"><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-4fbf0ba2aea81a6f79036954dca1031c14be9ec2.png" /><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line862">Now suppose repository <strong>Y</strong> has a branch based on one of these versions, which contains a non-exclusive checkout: <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867"><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-0c579e16774ca9e42bb7a0e279ce56b352f04ce7.png" /><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line862">If someone wants to replicate <tt>11.foo/checkout/3.jsmith_example.com.2/5</tt> to repository <strong>X</strong>, currently they can replicate that version in isolation.  To preserve a complete history, replication would need to follow the ancestry backwards until finding a version which already exists at the destination.  It would then copy all of the intervening history (<tt>11.foo/1</tt>, <tt>11.foo/2</tt>, and <tt>11.foo/3</tt>) to the destination in addition to the requested version. <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line862">This would ensure that the destination does not have a fragmented representation of the evolution up to the version in question.  This is necessary to enable anyone at repository <strong>X</strong> to perform a merge of <tt>11.foo/checkout/3.jsmith_example.com.2/5</tt> and <tt>13</tt>.  It's worth mentioning that repository <strong>Y</strong> may be inaccessible when the user wishes to perform such a merge operation.  Even if it is available, keeping a complete history locally will avoid the merge tool operating slowly by contacting remote repositories over the network to traverse the history. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line874">Note that in a more complex history that includes version with multiple parent versions (i.e. previous merges), the replication code would need to replicate back along all ancestry paths, not just the first one which reaches a version already present in the destination repository. <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line862">One problem with doing this currently has to do with the naming of versions.  What if the <tt>11.foo</tt> branch exists under a different hierarchy below <tt>/vesta</tt>?  Perhaps it's a foreign branch created with <a class="http" href="../../../vesta/doc/man/html/vbranch.1.html">vbranch</a>'s <tt>-F</tt> flag (introduced recently).  Do the <tt>#replicate-from</tt> attributes in repository <strong>X</strong> allow that hierarchy to be replicated from repository <strong>Y</strong>?  Of course they probably do if someone is going to replicate <tt>11.foo/checkout/3.jsmith_example.com.2/5</tt>.  However what if the branching is more complex and the ancestry passes through multiple different named hierarchies before reaching a version already present in the destination repository? <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line867">
<h3 id="Always_Replicate_Ancestry.3F">Always Replicate Ancestry?</h3>
<span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line874">Should replication always be required to follow ancestry like this? <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line862">Requiring that every replica contain the entire version history may take up more storage space.  Requiring the replicator to copy additional versions may take more time and network resources.  Perhaps the <tt>11.foo</tt> branch just contains a bug-fix that the user at repository <strong>X</strong> is only interested in building and testing without doing any development which might require merging.  In that case, the additional time to replicate and storage space at the destination repository might be wasted. <span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><p class="line862">Perhaps the user could tell the replicator whether they wish to follow ancestry or not.  Or, the replicator could attempt to guess whether the user is interested in building or active development based on the <a class="http" href="../../../vesta/doc/man/html/vrepl.1.html#Directives">replication directives</a>.  A reasonable first guess might be that any version explicitly mentioned in a <tt>+</tt> directive should have its history replicated, but versions added via the <tt>@</tt> (build imports) directive should just be copied without their history. <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line874">However, whatever method is used to make such a choice about replicating history, whether explicitly specified by the user or implicitly guessed by the tool, seems likely to be wrong at least some of the time.  This means allowing the possibility that insufficient history is available to perform a merge operation.  If we allow such &quot;insufficient history&quot; merge failures to happen, we should carefully consider the the consequences: <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><ul><li>Such merge failures would inconvenience the user. <span class="anchor" id="line-143"></span></li><li>The occurrence of such merge failures will seem random and arbitrary to a normal user. <span class="anchor" id="line-144"></span></li><li>Such failures might not ever be resolvable if portions of the history are lost or never made available to those parties interested in merging. <span class="anchor" id="line-145"></span></li><li><p class="line891"><strong>Vesta would be the only version control system with such failures in its merge system.</strong>  This could be a significant reason for people to decide not to use Vesta. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span></li></ul><p class="line874">Because there is a simple way to avoid such merge failures (always replicating a complete history), it seems prudent to do so.  But then Vesta becomes (the only?) system that forces a full replication just to do a build.  We need to balance the merge functionality against the basic version control and build functionality.  This could also be a significant reason for people to decide not to use Vesta. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line874">We can definitely mitigate the additional costs in terms of storage and replication latency. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line862">First of all, even today replicating a complete history would enable the repository to store each version's directory more efficiently in <tt>VMemPool</tt> space.  Replicating every other version, or even just replicating them in the reverse order of history, will cause each directory to be a complete copy at the destination rather than a delta over a base directory and thus consuming more space.  If replication always copies the full history, the repository can always store versions as deltas.  This would of course also reduce the latency of the copying operation. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line874">Secondly, we can implement compression of immutable source files, or even delta compression.  There are readily available libraries of code to do both.  In fact, having a complete history would make delta compression more feasible.  We could also use delta compression when sending files for replication, which would save more network bandwidth. <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line874">Finally, the current replication protocol has a number of inefficiencies which we can eliminate.  We will probably need to re-design the replication protocol anyway to facilitate following ancestry.  I am confident that we can make it significantly more efficient than the current protocol even if we always copy full history. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867">
<h3 id="Partial_History.2C_or_All_History.3F">Partial History, or All History?</h3>
<span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><p class="line874">The most conservative approach of replicating ancestry would be to always replicate the entire history, back to the first version (one with no previous version).  This would always ensure that there would be sufficient history to merge between any two parallel versions. <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line874">However in most cases a new developer wouldn't need the complete history back to the beginning of time.  They might need some recent history, but in general history becomes less useful the older it gets.  So it would be nice if there was an alternative to replicating back to the beginning of time. <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line874">Suppose for example we have a reasonably long history in one repository: <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line867"><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-87943f94f046a9f71a1909a62b8799e0208575b9.png" /><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line874">If a new repository is created, we might prefer to start by replicating only the latest version, on the theory that development will primarily move forward: <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><p class="line867"><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-f332d2fa387394c6bb6f8eeab523b226d21869e5.png" /><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line862">If then later someone at repository <strong>B</strong> wanted to replicate something from a branch off an earlier version, they would need to get some additional history: <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><p class="line867"><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-82b24b1bb34a6e3a98b66ab0c2f40f9d25686e59.png" /><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line874">This should work as long as there is sufficient history available when one repository wishes to replicate from another.  Suppose there are two branches that each started from a different point on the main line.  Suppose these are in two different repositories which each contain the history of those branches, but noting in the trunk other than the version from which they started: <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><p class="line867"><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-52eb6c9af0263cf115f18325e1e321395594e924.png" /><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><p class="line862">If one of these two repositories wanted to replicate the branch from the other one, there wouldn't be sufficient history to connect the two branches.  Presumably somewhere there's another repository which contains versions <tt>200</tt>, <tt>201</tt>, and <tt>202</tt> which could connect these two: <span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><p class="line867"><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><img src="HistoryManagement%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-55538bdb06c4db30b97e4c59c79f8202b9d91a0d.png" /><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><p class="line862">If repositories <strong>A</strong> and <strong>B</strong> could replicate those versions from repository <strong>C</strong> first, then their histories could be connected.  But what if repository <strong>C</strong> is inaccessible?  What if it has gone permanently off-line? <span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span><p class="line874">Perhaps this is unlikely to come up in practice, but it's a situation that's worth considering. <span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><p class="line867">
<h2 id="Relationship_to_File.2FDirectory_Rename.2FIdentity_Tracking">Relationship to File/Directory Rename/Identity Tracking</h2>
<span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><p class="line862">The way that file/directory identity is represented can impose constraints on whether history needs to be replicated.  See <a href="RenameTracking.html">MergingFuture/Food4Thought/RenameTracking</a>. <span class="anchor" id="line-427"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

