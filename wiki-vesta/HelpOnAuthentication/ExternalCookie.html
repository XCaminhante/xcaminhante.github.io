<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>HelpOnAuthentication/ExternalCookie - Vesta Wiki</title>
<script type="text/javascript" src="../moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: HelpOnAuthentication/ExternalCookie" href="ExternalCookie%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=HelpOnAuthentication%252FExternalCookie&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="ExternalCookie%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="ExternalCookie%3Faction=print.html">
<link rel="Up" href="../HelpOnAuthentication.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="ExternalCookie.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="../HelpOnAuthentication.html">HelpOnAuthentication</a></li><li><a href="ExternalCookie.html">ExternalCookie</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="ExternalCookie.html">ExternalCookie</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="ExternalCookie%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h1 id="Authenticate_Via_External_Cookie">Authenticate Via External Cookie</h1>
<span class="anchor" id="line-7"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="ExternalCookie.html#Authenticate_Via_External_Cookie">Authenticate Via External Cookie</a><ol><li>
<a href="ExternalCookie.html#Requirements">Requirements</a></li><li>
<a href="ExternalCookie.html#Strategy">Strategy</a></li><li>
<a href="ExternalCookie.html#Alternative_Strategies_Not_Implemented">Alternative Strategies Not Implemented</a></li><li>
<a href="ExternalCookie.html#ExternalCookie_Class">ExternalCookie Class</a></li><li>
<a href="ExternalCookie.html#Initial_Testing">Initial Testing</a></li><li>
<a href="ExternalCookie.html#Changing_the_Other_Application">Changing the Other Application</a></li><li>
<a href="ExternalCookie.html#Modifying_themes">Modifying themes</a></li><li>
<a href="ExternalCookie.html#Modifying_the_Application_Login_Page">Modifying the Application Login Page</a></li></ol></li></ol></div> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
<h2 id="Requirements">Requirements</h2>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">The external cookie authentication alternative may be a good choice for your installation if your <a href="MoinMoin.html">MoinMoin</a> wiki topic is closely associated with some other application.  You may be using <a href="MoinMoin.html">MoinMoin</a> for application documentation, popup help functions, or bug tracking.  Several of your application pages may have hyperlinks to wiki pages.  Wiki pages may contain custom macros that present data from your application database.  Wiki users must login before they can update wiki pages (or you wish that were the case).  Everyone with an application login ID also has a wiki login ID.  Your users are annoyed that they frequently must login twice, first to the other application and then to <a href="MoinMoin.html">MoinMoin</a>.  Your administrators are annoyed because they must maintain login IDs in two places. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">To authenticate a <a href="MoinMoin.html">MoinMoin</a> user with an external cookie, your other application must be modified to create a cookie with each successful login.  It must delete the cookie as part of the logout process.   <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">In order to prevent hackers from easily creating their own cookie, Moin<tt class="backtick"></tt>Moin transactions need to authenticate the cookie.  One way to do this is to modify your other application to store a hash of the cookie value in a database, file, or other secure shared storage area that can be accessed by <a href="MoinMoin.html">MoinMoin</a>.   <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line867">
<h2 id="Strategy">Strategy</h2>
<span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">The <a href="MoinMoin.html">MoinMoin</a> wiki code will be customized in two places.  <em>wikiconfig.py</em> will be modified to create a new External<tt class="backtick"></tt>Cookie class that will be used to authenticate a user.  Logging in to your other application will effectively log you in to the wiki.  Logging off of your other application will log you out of the wiki.  Several variables will be added to wikiconfig.py to customize the Settings:Preferences page and to automatically create new user records when required. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line862">Your wiki themes may be modified to override the <em>username</em> method of the Theme class.  This method generates the <em>login</em> and <em>logout</em> hyperlinks within the wiki navigation area.  These hyperlinks will be customized to point to the login and logout pages of your other application. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">You must modify your other application as outlined above to create/delete a cookie and (optionally) add/delete entries to a shared storage area.  If your wiki users can read the wiki without logging in, you may want to modify your other application login page so a wiki reader (logging in from a wiki page) will be returned to their referred-from page after login is complete (similar to the way <a href="MoinMoin.html">MoinMoin</a> login works).  <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line867">
<h2 id="Alternative_Strategies_Not_Implemented">Alternative Strategies Not Implemented</h2>
<span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line862">It is probably best to not synchronize inactivity timeouts between the other application and the wiki.  If a logged in user on the other application times out after an hour of inactivity, he can continue to edit and save pages on the wiki provided the other application timeout process is not modified to delete the entry in the shared storage area.  If the other application timed-out user logs in again, a new entry in the shared storage area will be created and a new Moin<tt class="backtick"></tt>Auth cookie generated -- subsequent wiki transactions will use the new cookie.  The example wikiconfig.py contains an example showing how inactive entries might be removed from a My<tt class="backtick"></tt>SQL table soon after expiration by a Moin<tt class="backtick"></tt>Moin transaction.  However, most installations will probably choose to clear obsolete entries in the shared storage area with a process embedded in the other application. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">One alternative to the use of a shared storage area is to encrypt the cookie in the other application and decrypt the cookie in the external_auth method.  If this method were implemented, the addition of a timestamp to the cookie value could force cookies to timeout with the addition of an aging check.  Without the aging check, any cookie generated would be valid forever (a minor issue) or until the encryption keys were changed.   Brief tests with the ezPy<tt class="backtick"></tt>Crypto example programs were discouraging because of the amount of compute time required.  My<tt class="backtick"></tt>SQL was faster -- the measured wall time to validate the cookie was usually 0 seconds and always less than 0.02 seconds.   <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">Another possibility to thwart the use of stolen cookies is to add the authenticated user's IP address to the cookie value and then check it against the IP address of the incoming Moin<tt class="backtick"></tt>Moin transaction.  But this has marginal value because some ISPs (AOL) change the low order bits of the IP address with each transaction and in other cases several users could appear to be coming from the same IP address. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line867">
<h2 id="ExternalCookie_Class">ExternalCookie Class</h2>
<span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line874">The first step is to override the external_auth method of the Config class by adding the code snippet below to your wikiconfig.py. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line874">The code below is for Moin 1.9.  <span class="anchor" id="line-43"></span><ul><li>edit your wikiconfig.py or farmconfig.py <span class="anchor" id="line-44"></span></li><li><p class="line862">find the line containing <tt class="backtick">class&nbsp;Config(DefaultConfig):</tt> or <tt class="backtick">class&nbsp;FarmConfig(DefaultConfig):</tt> <span class="anchor" id="line-45"></span></li><li>replace the above line with all of the code below <span class="anchor" id="line-46"></span></li><li><p class="line862">if using farmconfig.py find and comment/uncomment the appropriate <tt class="backtick">class</tt> statements <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span></li></ul><p class="line867"><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="ExternalCookie.html#" onclick="return togglenumber(\'CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35" lang="en"><span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_1">   1</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_1"></span><span class="anchor" id="line-1-2"></span><span class="Comment"># +++++++++++++++ beginning of external_cookie  example</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_2">   2</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_2"></span><span class="anchor" id="line-2-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_3">   3</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_3"></span><span class="anchor" id="line-3-1"></span><span class="Comment"># This is some sample code you might find useful when you want to use some</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_4">   4</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_4"></span><span class="anchor" id="line-4-1"></span><span class="Comment"># external cookie (made by some other program, not moin) with moin.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_5">   5</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_5"></span><span class="anchor" id="line-5-1"></span><span class="Comment"># See the +++ places for customizing it to your needs.  Copy this</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_6">   6</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_6"></span><span class="anchor" id="line-6-1"></span><span class="Comment"># code into your farmconfig.py or wikiconfig.py by pasting it over the current:</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_7">   7</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_7"></span><span class="anchor" id="line-7-1"></span><span class="Comment">#</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_8">   8</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_8"></span><span class="anchor" id="line-8-1"></span><span class="Comment">#    class Config(DefaultConfig):</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_9">   9</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_9"></span><span class="anchor" id="line-9-1"></span><span class="Comment"># OR</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_10">  10</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_10"></span><span class="anchor" id="line-10-1"></span><span class="Comment">#    class FarmConfig(DefaultConfig):</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_11">  11</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_11"></span><span class="anchor" id="line-11-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_12">  12</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_12"></span><span class="anchor" id="line-12-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_13">  13</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_13"></span><span class="anchor" id="line-13-1"></span><span class="ResWord">from</span> <span class="ID">MoinMoin.config.multiconfig</span> <span class="ResWord">import</span> <span class="ID">DefaultConfig</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_14">  14</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_14"></span><span class="anchor" id="line-14-1"></span><span class="ResWord">from</span> <span class="ID">MoinMoin.auth</span> <span class="ResWord">import</span> <span class="ID">BaseAuth</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_15">  15</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_15"></span><span class="anchor" id="line-15-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_16">  16</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_16"></span><span class="anchor" id="line-16-1"></span><span class="Comment"># This is included in case you want to create a log file during testing </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_17">  17</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_17"></span><span class="anchor" id="line-17-1"></span><span class="ResWord">import</span> <span class="ID">time</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_18">  18</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_18"></span><span class="anchor" id="line-18-1"></span><span class="ResWord">def</span> <span class="ID">writeLog</span>(*<span class="ID">args</span>): </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_19">  19</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_19"></span><span class="anchor" id="line-19-1"></span>    <span class="String">'''Write an entry in a log file with a timestamp and all of the args.'''</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_20">  20</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_20"></span><span class="anchor" id="line-20-1"></span>    <span class="ID">s</span> = <span class="ID">time</span>.<span class="ID">strftime</span>(<span class="String">'</span><span class="String">%</span><span class="String">Y-</span><span class="String">%</span><span class="String">m-</span><span class="String">%d</span><span class="String"> </span><span class="String">%</span><span class="String">H:</span><span class="String">%</span><span class="String">M:</span><span class="String">%</span><span class="String">S </span><span class="String">'</span>,<span class="ID">time</span>.<span class="ID">localtime</span>())</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_21">  21</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_21"></span><span class="anchor" id="line-21-1"></span>    <span class="ResWord">for</span> <span class="ID">a</span> <span class="ResWord">in</span> <span class="ID">args</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_22">  22</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_22"></span><span class="anchor" id="line-22-1"></span>        <span class="ID">s</span> = <span class="String">'</span><span class="String">%s</span><span class="String"> </span><span class="String">%s</span><span class="String">;</span><span class="String">'</span> % (<span class="ID">s</span>,<span class="ID">a</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_23">  23</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_23"></span><span class="anchor" id="line-23-1"></span>    <span class="ID">log</span> = <span class="ResWord">open</span>(<span class="String">'</span><span class="String">/somelogfile</span><span class="String">'</span>, <span class="String">'</span><span class="String">a</span><span class="String">'</span>) <span class="Comment"># +++ location for log file</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_24">  24</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_24"></span><span class="anchor" id="line-24-1"></span>    <span class="ID">log</span>.<span class="ID">write</span>(<span class="String">'</span><span class="SPChar">\n</span><span class="String">'</span> + <span class="ID">s</span> + <span class="String">'</span><span class="SPChar">\n</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_25">  25</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_25"></span><span class="anchor" id="line-25-1"></span>    <span class="ID">log</span>.<span class="ID">close</span>()</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_26">  26</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_26"></span><span class="anchor" id="line-26-1"></span>    <span class="ResWord">return</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_27">  27</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_27"></span><span class="anchor" id="line-27-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_28">  28</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_28"></span><span class="anchor" id="line-28-1"></span><span class="Comment"># these 2 methods are examples of how to &quot;authenticate&quot; the other application cookie</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_29">  29</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_29"></span><span class="anchor" id="line-29-1"></span><span class="ResWord">import</span> <span class="ID">MySQLdb</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_30">  30</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_30"></span><span class="anchor" id="line-30-1"></span><span class="ResWord">def</span> <span class="ID">verifySession</span>(<span class="ID">sidHash</span>): <span class="Comment"># +++ to use this, uncomment a procedure call below in ExternalCookie</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_31">  31</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_31"></span><span class="anchor" id="line-31-1"></span>    <span class="String">&quot;&quot;&quot;Return True if sidHash value exists (meaning user is currently logged on), false otherwise.  </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_32">  32</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_32"></span><span class="anchor" id="line-32-1"></span><span class="String">    </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_33">  33</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_33"></span><span class="anchor" id="line-33-1"></span><span class="String">    If you are not a MySQL user, find another way to store this information.  ActiveSession is a two-column table</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_34">  34</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_34"></span><span class="anchor" id="line-34-1"></span><span class="String">    containing a hashed cookie value (sidHash) plus a date-time stamp (tStamp).</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_35">  35</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_35"></span><span class="anchor" id="line-35-1"></span><span class="String">    Your other application must add an entry to this table each time a user logs on and delete the entry when the user logs off.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_36">  36</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_36"></span><span class="anchor" id="line-36-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_37">  37</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_37"></span><span class="anchor" id="line-37-1"></span>    <span class="ID">db</span> = <span class="ID">MySQLdb</span>.<span class="ID">connect</span>(<span class="ID">db</span>=<span class="String">'</span><span class="String">mydb</span><span class="String">'</span>,<span class="ID">user</span>=<span class="String">'</span><span class="String">myid</span><span class="String">'</span>,<span class="ID">passwd</span>=<span class="String">'</span><span class="String">mypw</span><span class="String">'</span>) <span class="Comment">#+++ user ID needs read access</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_38">  38</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_38"></span><span class="anchor" id="line-38-1"></span>    <span class="ID">c</span> = <span class="ID">db</span>.<span class="ID">cursor</span>()</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_39">  39</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_39"></span><span class="anchor" id="line-39-1"></span>    <span class="ID">q</span> = <span class="String">'</span><span class="String">select sidHash from ActiveSession where sidHash=</span><span class="String">&quot;</span><span class="String">%s</span><span class="String">&quot;</span><span class="String">'</span> % <span class="ID">sidHash</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_40">  40</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_40"></span><span class="anchor" id="line-40-1"></span>    <span class="ID">result</span> = <span class="ID">c</span>.<span class="ID">execute</span>(<span class="ID">q</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_41">  41</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_41"></span><span class="anchor" id="line-41-1"></span>    <span class="ID">c</span>.<span class="ID">close</span>()</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_42">  42</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_42"></span><span class="anchor" id="line-42-1"></span>    <span class="ResWord">if</span> <span class="ID">result</span> == <span class="Number">1</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_43">  43</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_43"></span><span class="anchor" id="line-43-1"></span>        <span class="ResWord">return</span> <span class="ResWord">True</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_44">  44</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_44"></span><span class="anchor" id="line-44-1"></span>    <span class="ResWord">return</span> <span class="ResWord">False</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_45">  45</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_45"></span><span class="anchor" id="line-45-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_46">  46</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_46"></span><span class="anchor" id="line-46-1"></span><span class="ResWord">def</span> <span class="ID">verifySessionPlus</span>(<span class="ID">sidHash</span>,<span class="ID">timeout</span>=<span class="Number">3600</span>*<span class="Number">4</span>): <span class="Comment"># +++ to use this, uncomment a procedure call below in ExternalCookie</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_47">  47</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_47"></span><span class="anchor" id="line-47-1"></span>    <span class="String">&quot;&quot;&quot;Return True if sidHash value exists (meaning user is currently logged on), false otherwise.  </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_48">  48</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_48"></span><span class="anchor" id="line-48-1"></span><span class="String">    </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_49">  49</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_49"></span><span class="anchor" id="line-49-1"></span><span class="String">    This version of verifySession deletes entries inactive for more than 4 hours and</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_50">  50</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_50"></span><span class="anchor" id="line-50-1"></span><span class="String">    updates the tStamp field with each moin transaction.  If performance is </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_51">  51</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_51"></span><span class="anchor" id="line-51-1"></span><span class="String">    important, find another way to delete inactive sessions.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_52">  52</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_52"></span><span class="anchor" id="line-52-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_53">  53</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_53"></span><span class="anchor" id="line-53-1"></span>    <span class="ID">db</span> = <span class="ID">MySQLdb</span>.<span class="ID">connect</span>(<span class="ID">db</span>=<span class="String">'</span><span class="String">mydb</span><span class="String">'</span>,<span class="ID">user</span>=<span class="String">'</span><span class="String">myid</span><span class="String">'</span>,<span class="ID">passwd</span>=<span class="String">'</span><span class="String">mypw</span><span class="String">'</span>) <span class="Comment"># +++ user ID needs write access</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_54">  54</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_54"></span><span class="anchor" id="line-54-1"></span>    <span class="ID">c</span> = <span class="ID">db</span>.<span class="ID">cursor</span>()</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_55">  55</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_55"></span><span class="anchor" id="line-55-1"></span>    <span class="ID">q</span> = <span class="String">'</span><span class="String">delete from ActiveSession where tStamp&lt;</span><span class="String">&quot;</span><span class="String">%s</span><span class="String">&quot;</span><span class="String">'</span> % <span class="ResWord">int</span>(<span class="ID">time</span>.<span class="ID">time</span>() - <span class="ID">timeout</span>) <span class="Comment"># delete inactive entries</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_56">  56</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_56"></span><span class="anchor" id="line-56-1"></span>    <span class="ID">result</span> = <span class="ID">c</span>.<span class="ID">execute</span>(<span class="ID">q</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_57">  57</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_57"></span><span class="anchor" id="line-57-1"></span>    <span class="ID">q</span> = <span class="String">'</span><span class="String">update ActiveSession set tStamp=</span><span class="String">%s</span><span class="String"> where sidHash=</span><span class="String">&quot;</span><span class="String">%s</span><span class="String">&quot;</span><span class="String">'</span> % (<span class="ResWord">int</span>(<span class="ID">time</span>.<span class="ID">time</span>()),<span class="ID">sidHash</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_58">  58</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_58"></span><span class="anchor" id="line-58-1"></span>    <span class="ID">result</span> = <span class="ID">c</span>.<span class="ID">execute</span>(<span class="ID">q</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_59">  59</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_59"></span><span class="anchor" id="line-59-1"></span>    <span class="ID">c</span>.<span class="ID">close</span>()</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_60">  60</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_60"></span><span class="anchor" id="line-60-1"></span>    <span class="ResWord">if</span> <span class="ID">result</span> == <span class="Number">1</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_61">  61</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_61"></span><span class="anchor" id="line-61-1"></span>        <span class="ResWord">return</span> <span class="ResWord">True</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_62">  62</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_62"></span><span class="anchor" id="line-62-1"></span>    <span class="ResWord">return</span> <span class="ResWord">False</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_63">  63</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_63"></span><span class="anchor" id="line-63-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_64">  64</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_64"></span><span class="anchor" id="line-64-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_65">  65</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_65"></span><span class="anchor" id="line-65-1"></span><span class="ResWord">class</span> <span class="ID">ExternalCookie</span>(<span class="ID">BaseAuth</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_66">  66</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_66"></span><span class="anchor" id="line-66-1"></span>    <span class="ID">name</span> = <span class="String">'</span><span class="String">external_cookie</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_67">  67</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_67"></span><span class="anchor" id="line-67-1"></span>    <span class="Comment"># +++ The next 2 lines may be useful if you are overriding the username method in your themes.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_68">  68</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_68"></span><span class="anchor" id="line-68-1"></span>    <span class="Comment"># +++  If commented out, wiki pages will not have login or logout hyperlinks</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_69">  69</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_69"></span><span class="anchor" id="line-69-1"></span>    <span class="ID">login_inputs</span> = [<span class="String">'</span><span class="String">username</span><span class="String">'</span>, <span class="String">'</span><span class="String">password</span><span class="String">'</span>] <span class="Comment"># +++ required to get a login hyperlink in wiki navigation area</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_70">  70</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_70"></span><span class="anchor" id="line-70-1"></span>    <span class="Comment"># logout_possible = True # +++ required to get a logout hyperlink in wiki navigation area</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_71">  71</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_71"></span><span class="anchor" id="line-71-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_72">  72</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_72"></span><span class="anchor" id="line-72-1"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">autocreate</span>=<span class="ResWord">False</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_73">  73</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_73"></span><span class="anchor" id="line-73-1"></span>        <span class="ResWord">self</span>.<span class="ID">autocreate</span> = <span class="ID">autocreate</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_74">  74</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_74"></span><span class="anchor" id="line-74-1"></span>        <span class="ID">BaseAuth</span>.<span class="ID">__init__</span>(<span class="ResWord">self</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_75">  75</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_75"></span><span class="anchor" id="line-75-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_76">  76</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_76"></span><span class="anchor" id="line-76-1"></span>    <span class="ResWord">def</span> <span class="ID">request</span>(<span class="ResWord">self</span>, <span class="ID">request</span>, <span class="ID">user_obj</span>, **<span class="ID">kw</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_77">  77</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_77"></span><span class="anchor" id="line-77-1"></span>        <span class="String">&quot;&quot;&quot;Return (user-obj,False) if user is authenticated, else return (None,True). &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_78">  78</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_78"></span><span class="anchor" id="line-78-1"></span>        <span class="Comment"># login = kw.get('login') # +++ example does not use this; login is expected in other application</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_79">  79</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_79"></span><span class="anchor" id="line-79-1"></span>        <span class="Comment"># user_obj = kw.get('user_obj')  # +++ example does not use this</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_80">  80</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_80"></span><span class="anchor" id="line-80-1"></span>        <span class="Comment"># username = kw.get('name') # +++ example does not use this</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_81">  81</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_81"></span><span class="anchor" id="line-81-1"></span>        <span class="Comment"># logout = kw.get('logout') # +++ example does not use this; logout is expected in other application</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_82">  82</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_82"></span><span class="anchor" id="line-82-1"></span>        <span class="ResWord">import</span> <span class="ID">Cookie</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_83">  83</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_83"></span><span class="anchor" id="line-83-1"></span>        <span class="ID">user</span> = <span class="ResWord">None</span>  <span class="Comment"># user is not authenticated</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_84">  84</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_84"></span><span class="anchor" id="line-84-1"></span>        <span class="ID">try_next</span> = <span class="ResWord">True</span>  <span class="Comment"># if True, moin tries the next auth method in auth list</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_85">  85</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_85"></span><span class="anchor" id="line-85-1"></span>        </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_86">  86</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_86"></span><span class="anchor" id="line-86-1"></span>        <span class="ID">otherAppCookie</span> = <span class="String">&quot;</span><span class="String">MoinAuth</span><span class="String">&quot;</span> <span class="Comment"># +++ username, email,useralias, session ID separated by #</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_87">  87</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_87"></span><span class="anchor" id="line-87-1"></span>        <span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_88">  88</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_88"></span><span class="anchor" id="line-88-1"></span>            <span class="ID">cookie</span> = <span class="ID">Cookie</span>.<span class="ID">SimpleCookie</span>(<span class="ID">request</span>.<span class="ID">cookies</span>) <span class="Comment">#moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_89">  89</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_89"></span><span class="anchor" id="line-89-1"></span>        <span class="ResWord">except</span> <span class="ID">Cookie</span>.<span class="ID">CookieError</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_90">  90</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_90"></span><span class="anchor" id="line-90-1"></span>            <span class="ID">cookie</span> = <span class="ResWord">None</span> <span class="Comment"># ignore invalid cookies</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_91">  91</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_91"></span><span class="anchor" id="line-91-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_92">  92</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_92"></span><span class="anchor" id="line-92-1"></span>        <span class="ResWord">if</span> <span class="ID">cookie</span> <span class="ResWord">and</span> <span class="ID">otherAppCookie</span> <span class="ResWord">in</span> <span class="ID">cookie</span>: <span class="Comment"># having this cookie means user auth has already been done in other application</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_93">  93</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_93"></span><span class="anchor" id="line-93-1"></span>            <span class="ResWord">import</span> <span class="ID">urllib</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_94">  94</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_94"></span><span class="anchor" id="line-94-1"></span>            <span class="ResWord">if</span> <span class="ID">sys</span>.<span class="ID">version_info</span>[:<span class="Number">2</span>] &gt; (<span class="Number">2</span>, <span class="Number">5</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_95">  95</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_95"></span><span class="anchor" id="line-95-1"></span>                <span class="ID">cookievalue</span> = <span class="ID">cookie</span>[<span class="ID">otherAppCookie</span>].<span class="ID">value</span> <span class="Comment"># moin 1.9 &amp; python 2.6</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_96">  96</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_96"></span><span class="anchor" id="line-96-1"></span>            <span class="ResWord">else</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_97">  97</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_97"></span><span class="anchor" id="line-97-1"></span>                <span class="ID">cookievalue</span> = <span class="ID">cookie</span>[<span class="ID">otherAppCookie</span>] <span class="Comment"># moin 1.9 &amp; python 2.5</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_98">  98</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_98"></span><span class="anchor" id="line-98-1"></span>            <span class="Comment"># writeLog('cookievalue',cookievalue)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_99">  99</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_99"></span><span class="anchor" id="line-99-1"></span>            <span class="Comment"># +++ decode and parse the cookie value - edit this to fit your needs.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_100"> 100</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_100"></span><span class="anchor" id="line-100-1"></span>            <span class="Comment">#~ cookievalue = urllib.unquote(cookievalue) # cookie value is urlencoded, decode it moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_101"> 101</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_101"></span><span class="anchor" id="line-101-1"></span>            <span class="Comment">#~ cookievalue = cookievalue.decode('iso-8859-1') # decode cookie charset to unicode moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_102"> 102</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_102"></span><span class="anchor" id="line-102-1"></span>            <span class="ID">cookievalue</span> = <span class="ID">cookievalue</span>[<span class="Number">1</span>: -<span class="Number">1</span>] <span class="Comment"># strip leading and ending quotes moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_103"> 103</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_103"></span><span class="anchor" id="line-103-1"></span>            <span class="Comment"># writeLog('cookievalue',cookievalue)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_104"> 104</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_104"></span><span class="anchor" id="line-104-1"></span>            <span class="ID">cookievalues</span> = <span class="ID">cookievalue</span>.<span class="ID">split</span>(<span class="String">'</span><span class="String">#</span><span class="String">'</span>) <span class="Comment"># cookie has format loginname#email#aliasname#sessionid</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_105"> 105</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_105"></span><span class="anchor" id="line-105-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_106"> 106</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_106"></span><span class="anchor" id="line-106-1"></span>            <span class="ID">email</span> = <span class="ID">aliasname</span> = <span class="ID">sessionid</span> = <span class="String">'</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_107"> 107</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_107"></span><span class="anchor" id="line-107-1"></span>            <span class="ResWord">try</span>:  <span class="Comment"># extract fields from other app cookie</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_108"> 108</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_108"></span><span class="anchor" id="line-108-1"></span>                <span class="ID">auth_username</span> = <span class="ID">cookievalues</span>[<span class="Number">0</span>] <span class="Comment"># the wiki username</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_109"> 109</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_109"></span><span class="anchor" id="line-109-1"></span>                <span class="ID">email</span> = <span class="ID">cookievalues</span>[<span class="Number">1</span>] <span class="Comment"># email is required for user to change and save userpreferences</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_110"> 110</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_110"></span><span class="anchor" id="line-110-1"></span>                <span class="ID">aliasname</span> = <span class="ID">cookievalues</span>[<span class="Number">2</span>] <span class="Comment"># aliasname is useful only if auth_username is not wiki-like</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_111"> 111</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_111"></span><span class="anchor" id="line-111-1"></span>                <span class="ID">sessionid</span> = <span class="ID">cookievalues</span>[<span class="Number">3</span>] <span class="Comment"># optional other app session ID  -- a unique timestamp or random number </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_112"> 112</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_112"></span><span class="anchor" id="line-112-1"></span>            <span class="ResWord">except</span> <span class="ID">IndexError</span>: </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_113"> 113</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_113"></span><span class="anchor" id="line-113-1"></span>                <span class="ResWord">pass</span>  <span class="Comment"># do not need aliasname or sessionid unless you uncomment lines below</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_114"> 114</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_114"></span><span class="anchor" id="line-114-1"></span>            <span class="Comment"># writeLog('auth_username',auth_username)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_115"> 115</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_115"></span><span class="anchor" id="line-115-1"></span>            <span class="Comment"># writeLog('email',email)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_116"> 116</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_116"></span><span class="anchor" id="line-116-1"></span>            <span class="Comment"># writeLog('aliasname',aliasname)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_117"> 117</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_117"></span><span class="anchor" id="line-117-1"></span>            <span class="Comment"># writeLog('sessionid',sessionid)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_118"> 118</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_118"></span><span class="anchor" id="line-118-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_119"> 119</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_119"></span><span class="anchor" id="line-119-1"></span>            <span class="Comment"># +++ any hacker can create a cookie, uncomment these lines to verify the cookie was created by the other application</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_120"> 120</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_120"></span><span class="anchor" id="line-120-1"></span>            <span class="ResWord">if</span> <span class="ID">auth_username</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_121"> 121</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_121"></span><span class="anchor" id="line-121-1"></span>                <span class="ResWord">import</span> <span class="ID">hashlib</span>  <span class="Comment"># +++ python 2.5; see http://code.krypto.org/python/hashlib for 2.3, 2.4 download</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_122"> 122</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_122"></span><span class="anchor" id="line-122-1"></span>                <span class="ID">sidHash</span> = <span class="ID">hashlib</span>.<span class="ID">md5</span>(<span class="ID">cookievalue</span>).<span class="ID">hexdigest</span>() <span class="Comment"># moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_123"> 123</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_123"></span><span class="anchor" id="line-123-1"></span>                <span class="Comment"># writeLog('sidHash',sidHash)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_124"> 124</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_124"></span><span class="anchor" id="line-124-1"></span>                <span class="ID">sidOK</span> = <span class="ID">verifySession</span>(<span class="ID">sidHash</span>) <span class="Comment"># verify user is currently logged on to the other application +++ or use verifySessionPlus</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_125"> 125</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_125"></span><span class="anchor" id="line-125-1"></span>                <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">sidOK</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_126"> 126</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_126"></span><span class="anchor" id="line-126-1"></span>                    <span class="ID">auth_username</span> = <span class="ResWord">None</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_127"> 127</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_127"></span><span class="anchor" id="line-127-1"></span>            <span class="Comment"># writeLog('auth_username after verifySession',auth_username)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_128"> 128</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_128"></span><span class="anchor" id="line-128-1"></span>            </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_129"> 129</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_129"></span><span class="anchor" id="line-129-1"></span>            <span class="ResWord">if</span> <span class="ID">auth_username</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_130"> 130</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_130"></span><span class="anchor" id="line-130-1"></span>                <span class="Comment"># we have an authorized user, create the moin user object</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_131"> 131</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_131"></span><span class="anchor" id="line-131-1"></span>                <span class="ResWord">from</span> <span class="ID">MoinMoin.user</span> <span class="ResWord">import</span> <span class="ID">User</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_132"> 132</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_132"></span><span class="anchor" id="line-132-1"></span>                <span class="Comment"># giving auth_username to User constructor means that authentication has already been done.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_133"> 133</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_133"></span><span class="anchor" id="line-133-1"></span>                <span class="ID">user</span> = <span class="ID">User</span>(<span class="ID">request</span>, <span class="ID">name</span>=<span class="ID">auth_username</span>, <span class="ID">auth_username</span>=<span class="ID">auth_username</span>, <span class="ID">auth_method</span>=<span class="ResWord">self</span>.<span class="ID">name</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_134"> 134</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_134"></span><span class="anchor" id="line-134-1"></span>                <span class="ID">changed</span> = <span class="ResWord">False</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_135"> 135</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_135"></span><span class="anchor" id="line-135-1"></span>                <span class="ResWord">if</span> <span class="ID">email</span> != <span class="ID">user</span>.<span class="ID">email</span>: <span class="Comment"># was the email addr externally updated?</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_136"> 136</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_136"></span><span class="anchor" id="line-136-1"></span>                    <span class="ID">user</span>.<span class="ID">email</span> = <span class="ID">email</span> ; </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_137"> 137</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_137"></span><span class="anchor" id="line-137-1"></span>                    <span class="ID">changed</span> = <span class="ResWord">True</span> <span class="Comment"># yes -&gt; update user profile</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_138"> 138</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_138"></span><span class="anchor" id="line-138-1"></span>                <span class="Comment"># if aliasname != user.aliasname: # +++ was the aliasname externally updated?</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_139"> 139</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_139"></span><span class="anchor" id="line-139-1"></span>                    <span class="Comment"># user.aliasname = aliasname ; </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_140"> 140</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_140"></span><span class="anchor" id="line-140-1"></span>                    <span class="Comment"># changed = True # yes -&gt; update user profile</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_141"> 141</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_141"></span><span class="anchor" id="line-141-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_142"> 142</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_142"></span><span class="anchor" id="line-142-1"></span>                <span class="ResWord">if</span> <span class="ID">user</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_143"> 143</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_143"></span><span class="anchor" id="line-143-1"></span>                    <span class="ID">user</span>.<span class="ID">create_or_update</span>(<span class="ID">changed</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_144"> 144</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_144"></span><span class="anchor" id="line-144-1"></span>                <span class="ResWord">if</span> <span class="ID">user</span> <span class="ResWord">and</span> <span class="ID">user</span>.<span class="ID">valid</span>: </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_145"> 145</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_145"></span><span class="anchor" id="line-145-1"></span>                    <span class="ID">try_next</span> = <span class="ResWord">False</span> <span class="Comment"># have valid user; stop processing auth method list</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_146"> 146</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_146"></span><span class="anchor" id="line-146-1"></span>        <span class="Comment"># writeLog(str(user), try_next)</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_147"> 147</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_147"></span><span class="anchor" id="line-147-1"></span>        <span class="ResWord">return</span> <span class="ID">user</span>, <span class="ID">try_next</span> </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_148"> 148</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_148"></span><span class="anchor" id="line-148-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_149"> 149</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_149"></span><span class="anchor" id="line-149-1"></span><span class="ResWord">from</span> <span class="ID">MoinMoin.config</span> <span class="ResWord">import</span> <span class="ID">multiconfig</span>, <span class="ID">url_prefix_static</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_150"> 150</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_150"></span><span class="anchor" id="line-150-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_151"> 151</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_151"></span><span class="anchor" id="line-151-1"></span><span class="ResWord">class</span> <span class="ID">Config</span>(<span class="ID">multiconfig</span>.<span class="ID">DefaultConfig</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_152"> 152</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_152"></span><span class="anchor" id="line-152-1"></span><span class="Comment"># class FarmConfig(multiconfig.DefaultConfig):</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_153"> 153</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_153"></span><span class="anchor" id="line-153-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_154"> 154</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_154"></span><span class="anchor" id="line-154-1"></span>    <span class="ID">auth</span> = [<span class="ID">ExternalCookie</span>(<span class="ID">autocreate</span>=<span class="ResWord">True</span>)] <span class="Comment"># only way to login is external application # autocreate parameter new in 1.8.0</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_155"> 155</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_155"></span><span class="anchor" id="line-155-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_156"> 156</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_156"></span><span class="anchor" id="line-156-1"></span>    <span class="Comment"># +++ these are suggested changes to the user preferences form if the  external_cookie  is the only auth method</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_157"> 157</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_157"></span><span class="anchor" id="line-157-1"></span>    <span class="ID">user_form_disable</span> = [<span class="String">'</span><span class="String">name</span><span class="String">'</span>, <span class="String">'</span><span class="String">aliasname</span><span class="String">'</span>, <span class="String">'</span><span class="String">email</span><span class="String">'</span>,] <span class="Comment"># don't let the user change these, but show them:</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_158"> 158</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_158"></span><span class="anchor" id="line-158-1"></span>    <span class="ID">user_form_remove</span> = [<span class="String">'</span><span class="String">password</span><span class="String">'</span>, <span class="String">'</span><span class="String">password2</span><span class="String">'</span>, <span class="String">'</span><span class="String">css_url</span><span class="String">'</span>, <span class="String">'</span><span class="String">logout</span><span class="String">'</span>, <span class="String">'</span><span class="String">create</span><span class="String">'</span>, <span class="String">'</span><span class="String">account_sendmail</span><span class="String">'</span>,<span class="String">'</span><span class="String">jid</span><span class="String">'</span>] <span class="Comment"># remove completely:</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_159"> 159</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_159"></span><span class="anchor" id="line-159-1"></span>    <span class="Comment">#~ user_autocreate = True # +++ Moin will autocreate new user ID if none exists</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_160"> 160</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_160"></span><span class="anchor" id="line-160-1"></span>    <span class="ID">cookie_lifetime</span> = (<span class="Number">12</span>, <span class="Number">12</span>)   <span class="Comment"># (anonymous,logged-in) default (0,12)  page trails for anonymous users moin 1.9</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_161"> 161</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_161"></span><span class="anchor" id="line-161-1"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_162"> 162</a> </span><span class="LineAnchor" id="CA-ac0c284f41ada9f9a363a8f5366cc56e9dcb5e35_162"></span><span class="anchor" id="line-162-1"></span><span class="Comment"># +++++++++++++++ end of external_cookie  example,  your custom configurations continue below </span></span>
</pre></div></div><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line867">
<h2 id="Initial_Testing">Initial Testing</h2>
<span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><p class="line874">If you use the Firefox browser and have the Web Developer addon extension installed, initial testing will be fast and painless. Log on to your other application and click on Tools... Web Developer... Cookies... View Cookie Information.  You will probably find at least one cookie that looks like a session identifier created by your application at login, usually these will have a value with a large random number and perhaps a time stamp. <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><p class="line862">Next, click on Tools... Web Developer... Cookies... Add Cookie.  Give the cookie a name of <em>Moin<tt class="backtick"></tt>Auth</em> (case sensitive). Set the value to <tt class="backtick">yourname#youremail@yourprovider.com</tt> with no spaces, and be sure to use the <strong>#</strong> character as a separator.  If your other application and the wiki run on the same host, set the host to the same value used by your other application (if not, omit the host from the domain name to share cookies across hosts).  Set the path value to &quot;/&quot; without the quotes.  Click the <em>Session Cookie</em> check box and click save. <span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line874">Open a second browser window and load your starting wiki page.  The wiki should recognize you as a logged in user. Do a quick test to verify that you can edit and save a wiki page and verify that you can change your User Preferences.   <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><p class="line867">
<h2 id="Changing_the_Other_Application">Changing the Other Application</h2>
<span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><p class="line862">The example external_cookie method expects the cookie value to contain several pieces of information separated with the <strong>#</strong> character: <span class="anchor" id="line-224"></span><ul><li>the wiki user id -- always required <span class="anchor" id="line-225"></span></li><li><p class="line862">the user's email address -- needed if the user is to be able to update and save <a href="MoinMoin.html">MoinMoin</a> User Preferences <span class="anchor" id="line-226"></span></li><li>user alias -- usually not required, used to override user IDs that are not wiki-like user names <span class="anchor" id="line-227"></span></li><li>unique session ID -- a big random number or timestamp and random number <span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span></li></ul><p class="line862">Your application must store the Moin<tt class="backtick"></tt>Auth cookie with a path set to '/'.  Setting the path to '/' is normally not recommended because it presents a small security risk.  It allows an application to read the cookies created by a different application.  In this case, that is exactly our intent -- <a href="MoinMoin.html">MoinMoin</a> must be able to read the cookies set by the other application. <span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><p class="line874">As you have already demonstrated to yourself above, any user with the skill to install the Firefox Web Developer addon could easily create a cookie and hack his way into the wiki using someone else's ID.     <span class="anchor" id="line-232"></span>To prevent this from happening, <a href="MoinMoin.html">MoinMoin</a> will need to validate the cookie value against an entry in a secure shared storage area created by the other application.    <span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line862">We want to avoid creating a potential new security issue by building a cross-reference of user ID to session ID or even a list of session IDs that might be of use to a hacker.  A better way is for your application to hash (not encrypt) the Moin<tt class="backtick"></tt>Auth cookie value and store the result in a secure shared storage area.  Add a timestamp to each entry so obsolete entries can be removed later.   <span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><p class="line862">There is commented out code in the example wikiconfig.py to perform a hash of the cookie contents and validate the result against a MySQL table.  In addition, there is alternative commented out code that will delete entries from the My<tt class="backtick"></tt>SQL table that are more than 4 hours old, validate the hashed cookie value against the table and update the timestamp.  A better method is to modify the other application to remove obsolete entries from the table, perhaps each time a user logs in. <span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><p class="line862">As you begin to modify your application almost all of your testing can be done with the Firefox Web Developer extension.  Before you login to the other application there should be no Moin<tt class="backtick"></tt>Auth cookie, after login there should be a Moin<tt class="backtick"></tt>Auth cookie, after logout there should be no cookie. In addition, the shared storage area should be updated with a new hashed cookie value after login and cleared after logout.  Accessing a wiki page after you are logged in will cause moin to create a MOIN_SESSION cookie. <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><p class="line867">
<h2 id="Modifying_themes">Modifying themes</h2>
<span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><p class="line862">The next step is to modify the login and logout links in the navigation area of wiki pages.  If you limit your users to one theme, modify the code below to point to your other application's login and logoff pages.  If you allow users to choose from among several themes, it may be easiest to modify the /Moin<tt class="backtick"></tt>Moin/theme/<span class="u">init</span>.py script directly. <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line862">If you always log on to your other application before accessing a wiki page, this modification and the one following are not required.  If you comment out the <tt class="backtick">login_inputs</tt> and <tt class="backtick">logout_possible</tt> variables near the top of the External<tt class="backtick"></tt>Cookie class, then your wiki pages will not contain login and logout hyperlinks. <span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><p class="line874">The code below is for moin 1.9. <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><p class="line867"><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="ExternalCookie.html#" onclick="return togglenumber(\'CA-37d04a0a22224368700197eff3059653f08ed872\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-37d04a0a22224368700197eff3059653f08ed872" lang="en"><span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_1">   1</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_1"></span><span class="anchor" id="line-1-4"></span>    <span class="ResWord">def</span> <span class="ID">username</span>(<span class="ResWord">self</span>, <span class="ID">d</span>):</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_2">   2</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_2"></span><span class="anchor" id="line-2-2"></span>        <span class="String">&quot;&quot;&quot; Assemble the username / userprefs link</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_3">   3</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_3"></span><span class="anchor" id="line-3-2"></span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_4">   4</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_4"></span><span class="anchor" id="line-4-2"></span><span class="String">        @param d: parameter dictionary</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_5">   5</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_5"></span><span class="anchor" id="line-5-2"></span><span class="String">        @rtype: unicode</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_6">   6</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_6"></span><span class="anchor" id="line-6-2"></span><span class="String">        @return: username html</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_7">   7</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_7"></span><span class="anchor" id="line-7-2"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_8">   8</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_8"></span><span class="anchor" id="line-8-2"></span>        <span class="ID">request</span> = <span class="ResWord">self</span>.<span class="ID">request</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_9">   9</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_9"></span><span class="anchor" id="line-9-2"></span>        <span class="ID">_</span> = <span class="ID">request</span>.<span class="ID">getText</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_10">  10</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_10"></span><span class="anchor" id="line-10-2"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_11">  11</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_11"></span><span class="anchor" id="line-11-2"></span>        <span class="ID">userlinks</span> = []</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_12">  12</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_12"></span><span class="anchor" id="line-12-2"></span>        <span class="Comment"># Add username/homepage link for registered users. We don't care</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_13">  13</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_13"></span><span class="anchor" id="line-13-2"></span>        <span class="Comment"># if it exists, the user can create it.</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_14">  14</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_14"></span><span class="anchor" id="line-14-2"></span>        <span class="ResWord">if</span> <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">valid</span> <span class="ResWord">and</span> <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">name</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_15">  15</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_15"></span><span class="anchor" id="line-15-2"></span>            <span class="ID">interwiki</span> = <span class="ID">wikiutil</span>.<span class="ID">getInterwikiHomePage</span>(<span class="ID">request</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_16">  16</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_16"></span><span class="anchor" id="line-16-2"></span>            <span class="ID">name</span> = <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">name</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_17">  17</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_17"></span><span class="anchor" id="line-17-2"></span>            <span class="ID">aliasname</span> = <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">aliasname</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_18">  18</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_18"></span><span class="anchor" id="line-18-2"></span>            <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">aliasname</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_19">  19</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_19"></span><span class="anchor" id="line-19-2"></span>                <span class="ID">aliasname</span> = <span class="ID">name</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_20">  20</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_20"></span><span class="anchor" id="line-20-2"></span>            <span class="ID">title</span> = <span class="String">&quot;</span><span class="String">%s</span><span class="String"> @ </span><span class="String">%s</span><span class="String">&quot;</span> % (<span class="ID">aliasname</span>, <span class="ID">interwiki</span>[<span class="Number">0</span>])</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_21">  21</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_21"></span><span class="anchor" id="line-21-2"></span>            <span class="Comment"># link to (interwiki) user homepage</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_22">  22</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_22"></span><span class="anchor" id="line-22-2"></span>            <span class="ID">homelink</span> = (<span class="ID">request</span>.<span class="ID">formatter</span>.<span class="ID">interwikilink</span>(<span class="Number">1</span>, <span class="ID">title</span>=<span class="ID">title</span>, <span class="ResWord">id</span>=<span class="String">&quot;</span><span class="String">userhome</span><span class="String">&quot;</span>, <span class="ID">generated</span>=<span class="ResWord">True</span>, *<span class="ID">interwiki</span>) +</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_23">  23</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_23"></span><span class="anchor" id="line-23-2"></span>                        <span class="ID">request</span>.<span class="ID">formatter</span>.<span class="ID">text</span>(<span class="ID">name</span>) +</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_24">  24</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_24"></span><span class="anchor" id="line-24-2"></span>                        <span class="ID">request</span>.<span class="ID">formatter</span>.<span class="ID">interwikilink</span>(<span class="Number">0</span>, <span class="ID">title</span>=<span class="ID">title</span>, <span class="ResWord">id</span>=<span class="String">&quot;</span><span class="String">userhome</span><span class="String">&quot;</span>, *<span class="ID">interwiki</span>))</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_25">  25</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_25"></span><span class="anchor" id="line-25-2"></span>            <span class="ID">userlinks</span>.<span class="ID">append</span>(<span class="ID">homelink</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_26">  26</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_26"></span><span class="anchor" id="line-26-2"></span>            <span class="Comment"># link to userprefs action</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_27">  27</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_27"></span><span class="anchor" id="line-27-2"></span>            <span class="ResWord">if</span> <span class="String">'</span><span class="String">userprefs</span><span class="String">'</span> <span class="ResWord">not</span> <span class="ResWord">in</span> <span class="ResWord">self</span>.<span class="ID">request</span>.<span class="ID">cfg</span>.<span class="ID">actions_excluded</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_28">  28</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_28"></span><span class="anchor" id="line-28-2"></span>                <span class="ID">userlinks</span>.<span class="ID">append</span>(<span class="ID">d</span>[<span class="String">'</span><span class="String">page</span><span class="String">'</span>].<span class="ID">link_to</span>(<span class="ID">request</span>, <span class="ID">text</span>=<span class="ID">_</span>(<span class="String">'</span><span class="String">Settings</span><span class="String">'</span>),</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_29">  29</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_29"></span><span class="anchor" id="line-29-2"></span>                                               <span class="ID">querystr</span>={<span class="String">'</span><span class="String">action</span><span class="String">'</span>: <span class="String">'</span><span class="String">userprefs</span><span class="String">'</span>}, <span class="ResWord">id</span>=<span class="String">'</span><span class="String">userprefs</span><span class="String">'</span>, <span class="ID">rel</span>=<span class="String">'</span><span class="String">nofollow</span><span class="String">'</span>))</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_30">  30</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_30"></span><span class="anchor" id="line-30-2"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_31">  31</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_31"></span><span class="anchor" id="line-31-2"></span>        <span class="ResWord">if</span> <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">valid</span>:  </span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_32">  32</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_32"></span><span class="anchor" id="line-32-2"></span>            <span class="ResWord">if</span> <span class="ID">request</span>.<span class="ID">user</span>.<span class="ID">auth_method</span> <span class="ResWord">in</span> <span class="ID">request</span>.<span class="ID">cfg</span>.<span class="ID">auth_can_logout</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_33">  33</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_33"></span><span class="anchor" id="line-33-2"></span>                <span class="ID">userlinks</span>.<span class="ID">append</span>(<span class="String">'</span><span class="String">&lt;a href=</span><span class="String">&quot;</span><span class="String">/myapp/Logout</span><span class="String">&quot;</span><span class="String">&gt;</span><span class="String">%s</span><span class="String">&lt;/a&gt;</span><span class="String">'</span> % <span class="ID">_</span>(<span class="String">'</span><span class="String">Logout</span><span class="String">'</span>, <span class="ID">formatted</span>=<span class="ResWord">False</span>)) <span class="Comment"># +++ other app logout page</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_34">  34</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_34"></span><span class="anchor" id="line-34-2"></span>        <span class="ResWord">else</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_35">  35</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_35"></span><span class="anchor" id="line-35-2"></span>            <span class="ID">query</span> = {<span class="String">'</span><span class="String">action</span><span class="String">'</span>: <span class="String">'</span><span class="String">login</span><span class="String">'</span>}</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_36">  36</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_36"></span><span class="anchor" id="line-36-2"></span>            <span class="Comment"># special direct-login link if the auth methods want no input</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_37">  37</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_37"></span><span class="anchor" id="line-37-2"></span>            <span class="ResWord">if</span> <span class="ID">request</span>.<span class="ID">cfg</span>.<span class="ID">auth_login_inputs</span> == [<span class="String">'</span><span class="String">special_no_input</span><span class="String">'</span>]:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_38">  38</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_38"></span><span class="anchor" id="line-38-2"></span>                <span class="ID">query</span>[<span class="String">'</span><span class="String">login</span><span class="String">'</span>] = <span class="String">'</span><span class="String">1</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_39">  39</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_39"></span><span class="anchor" id="line-39-2"></span>            <span class="ResWord">if</span> <span class="ID">request</span>.<span class="ID">cfg</span>.<span class="ID">auth_have_login</span>:</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_40">  40</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_40"></span><span class="anchor" id="line-40-2"></span>                <span class="ID">userlinks</span>.<span class="ID">append</span>(<span class="String">'</span><span class="String">&lt;a  href=</span><span class="String">&quot;</span><span class="String">/myapp/Login</span><span class="String">&quot;</span><span class="String">&gt;</span><span class="String">%s</span><span class="String">&lt;/a&gt;</span><span class="String">'</span> % <span class="ID">_</span>(<span class="String">&quot;</span><span class="String">Login</span><span class="String">&quot;</span>, <span class="ID">formatted</span>=<span class="ResWord">False</span>)) <span class="Comment"># +++ other app login page</span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_41">  41</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_41"></span><span class="anchor" id="line-41-2"></span></span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_42">  42</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_42"></span><span class="anchor" id="line-42-2"></span>        <span class="ID">userlinks</span> = [<span class="String">u</span><span class="String">'</span><span class="String">&lt;li&gt;</span><span class="String">%s</span><span class="String">&lt;/li&gt;</span><span class="String">'</span> % <span class="ID">link</span> <span class="ResWord">for</span> <span class="ID">link</span> <span class="ResWord">in</span> <span class="ID">userlinks</span>]</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_43">  43</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_43"></span><span class="anchor" id="line-43-2"></span>        <span class="ID">html</span> = <span class="String">u</span><span class="String">'</span><span class="String">&lt;ul id=</span><span class="String">&quot;</span><span class="String">username</span><span class="String">&quot;</span><span class="String">&gt;</span><span class="String">%s</span><span class="String">&lt;/ul&gt;</span><span class="String">'</span> % <span class="String">'</span><span class="String">'</span>.<span class="ID">join</span>(<span class="ID">userlinks</span>)</span>
<span class="line"><span class="LineNumber"><a href="ExternalCookie.html#CA-37d04a0a22224368700197eff3059653f08ed872_44">  44</a> </span><span class="LineAnchor" id="CA-37d04a0a22224368700197eff3059653f08ed872_44"></span><span class="anchor" id="line-44-2"></span>        <span class="ResWord">return</span> <span class="ID">html</span></span>
</pre></div></div><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><p class="line867">
<h2 id="Modifying_the_Application_Login_Page">Modifying the Application Login Page</h2>
<span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line874">As a final touch, you may want to consider modifying your login page for wiki users who decide to login from a wiki page.  This depends upon your choice of web servers, but most will pass something similar to an HTTP_REFERER field which will contain the prior URL.   <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line874">Check this value to determine if the referrer page was a wiki page, if so save the URL and at the end of a successful logon either redirect the current page back the referring wiki page or open a new window with the URL of the referring page. <span class="anchor" id="line-304"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

