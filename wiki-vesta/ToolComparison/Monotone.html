<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>ToolComparison/Monotone - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: ToolComparison/Monotone" href="Monotone%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=ToolComparison%252FMonotone&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="Monotone%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="Monotone%3Faction=print.html">
<link rel="Up" href="../ToolComparison.html">
<link rel="Appendix" title="autogenerated-779abbcd9a6966d649fd46fd675fae1ae09fd996.png" href="Monotone%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-779abbcd9a6966d649fd46fd675fae1ae09fd996.png.html">
<link rel="Appendix" title="autogenerated-88c1a03cb76984b9e541a2961cbe72c21ce09358.png" href="Monotone%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-88c1a03cb76984b9e541a2961cbe72c21ce09358.png.html">
<link rel="Appendix" title="delete.me.to.regenerate.images" href="Monotone%3Faction=AttachFile&amp;do=view&amp;target=delete.me.to.regenerate.images.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="Monotone.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="../ToolComparison.html">ToolComparison</a></li><li><a href="Monotone.html">Monotone</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="Monotone.html">ToolComparison/Monotone</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="Monotone%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="Monotone.html#Introduction">Introduction</a></li><li>
<a href="Monotone.html#File_Store">File Store</a><ol><li>
<a href="Monotone.html#Similarities">Similarities</a></li><li>
<a href="Monotone.html#Differences">Differences</a></li></ol></li><li>
<a href="Monotone.html#History_Storage">History Storage</a><ol><li>
<a href="Monotone.html#Similarities-1">Similarities</a></li><li>
<a href="Monotone.html#Differences-1">Differences</a></li></ol></li><li>
<a href="Monotone.html#Revision_Attributes">Revision Attributes</a><ol><li>
<a href="Monotone.html#Similarities-2">Similarities</a></li><li>
<a href="Monotone.html#Differences-2">Differences</a></li></ol></li><li>
<a href="Monotone.html#Merge_Technology">Merge Technology</a><ol><li>
<a href="Monotone.html#Mark_Merge">Mark Merge</a><ol><li>
<a href="Monotone.html#Roster_Example">Roster Example</a></li></ol></li><li>
<a href="Monotone.html#File_Life-cycle">File Life-cycle</a></li><li>
<a href="Monotone.html#Directory_Structure_Conflicts">Directory Structure Conflicts</a></li><li>
<a href="Monotone.html#Pluck">Pluck</a></li></ol></li><li>
<a href="Monotone.html#Other_Random_Observations">Other Random Observations</a></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867"><a class="http" href="http://venge.net/monotone/">Monotone</a> is a free software revision control system. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">It was one of the first (possibly the first?) to use the concept of referring to revisions by cryptographic hashes of their contents and ancestry.  Some people have used the term &quot;chained hash version control&quot; to refer to this idea.  Other examples include <a class="http" href="http://www.kernel.org/pub/software/scm/git/docs/">git</a> (arguably inspired by monotone in many ways) and <a class="http" href="http://codeville.org/">Codeville</a>. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867">
<h1 id="File_Store">File Store</h1>
<span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867">
<h2 id="Similarities">Similarities</h2>
<span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line874">Both Vesta and monotone store versions of files as immutable objects which can be rferenced by a handle. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">Both associate a large number with each file version by which it can be identifed.  monotone uses the well-known <a class="http" href="http://en.wikipedia.org/wiki/SHA1">SHA1 hash function</a>.  Vesta uses it's own <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/vesta/fp">fingerprinting algorithm</a>. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line867">
<h2 id="Differences">Differences</h2>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line874">While files in Vesta can be referenced by 128-bit fingerprints, they are much more often referenced by 32-bit &quot;short ids&quot;.  These are essentially a pointer into the local repository's file storage pool and are not portable across different repositories.  However, they obviously take up far less space.  This is an important concern for Vesta, as it keeps all directory representations of all immutable versions and all working copies in memory.  Also, shortids are used for derived files produced by the build system, and storing and transmitting sets of them is an area of concern for efficiency. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">In contrast, monotone refers to files only by 160-bit SHA1 hashes. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line862">Vesta may assign files fingerprints based on their contents, but it is not required to.  (See <a class="http" href="../../vesta/doc/man/html/vadvance.1.html#-F">the descirption of vadvance's -F flag</a>.)  In contrast, monotone always comptues the SHA1 hash of every new file. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line867">
<h1 id="History_Storage">History Storage</h1>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867">
<h2 id="Similarities-1">Similarities</h2>
<span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line874">Both Vesta and monotone store versions as immutable objects.  Once cretaed, they cannot be changed. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line862">Both associate a large number with each revision by which it can be identifed.  monotone uses the well-known <a class="http" href="http://en.wikipedia.org/wiki/SHA1">SHA1 hash function</a>.  Vesta uses it's own <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/vesta/fp">fingerprinting algorithm</a>. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867">
<h2 id="Differences-1">Differences</h2>
<span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line862">For each revision, monotone stores both a complete record of the entire contents (called a <a class="http" href="http://venge.net/monotone/docs/Versions-of-trees.html">manifest</a>) and the changes made to transform the old version into the new version (sotred as part of each <a class="http" href="http://venge.net/monotone/docs/Historical-records.html">revision record</a>).  The manifests are redundant with the changes, as the manifest for a revision can be rebuilt by applying the changes starting from the beginning of time.  Note that the record of changes can include information which cannot be computed simply by comparing two manifests, such as &quot;file <strong>A</strong> was renamed to <strong>B</strong>&quot;. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line874">In contrast, Vesta stores directory contents as either a delta from a previous version or a complete copy.  When a new version is created locally, it is always stored as a directory delta.  When it is replicated from a peer repository, it is replicated as a directory delta if the previous version already exists at the destination or as a complete copy if the previous version doesn't exist at the destination.  Furthermore, the Vesta repository treats directory deltas more as a storage optimization than as a historical record.  In certain cases, parts of the deltas can be discarded.  The only guarantee that the repository provides is that as long as there is a reference to a particular version in its virtual filesystem, it will retain the complete contents of that revision. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">Essentially, the Vesta repository is more a filesystem than history store.  This is a problem for advanced merging, as most algorithms do need to know the exact changes between each version along the path from the two versions to be merged and one or more common ancestors. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line874">Having both types of records in monotone provides the added benefit of being able to perform internal consistency checks, avoiding potential bugs in the delta application code.  While the changes cannot be derived by comparing complete revisions, the next revision can be derived by applying a set of changes to the old revision's manifest.  Also, since monotone uses cryptographic signatures it's desirable to have a direct representation of what a user is attesting to.  The manifest provides a direct representation of what the user is signing, which may be easier to trust than the changset data structures and the code which can apply changesets to produce a particular revision. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line874">Here's a brief comparison of the kinds of records in monotone revisions and Vesta delta directories: <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><div><table><tbody><tr>  <td><p class="line891"><strong>monotone</strong></td>
  <td><p class="line891"><strong>Vesta</strong></td>
</tr>
<tr>  <td><span class="anchor" id="line-50"></span><p class="line862">Files/directories deleted</td>
  <td><p class="line862">Directory delta entries with the <a href="../../vestaSource.html">VestaSource</a>::deleted type</td>
</tr>
<tr>  <td><span class="anchor" id="line-51"></span><p class="line862">Files/directories added</td>
  <td><p class="line862">Directory delta entries</td>
</tr>
<tr>  <td><span class="anchor" id="line-52"></span><p class="line862">Files/directories renamed</td>
  <td><p class="line862">Both a deletion and an addition (notably a problem for merging</td>
</tr>
<tr>  <td><span class="anchor" id="line-53"></span><p class="line862">Files modified</td>
  <td><p class="line862">Directory delta entries shadowing ones in the old version</td>
</tr>
<tr>  <td><span class="anchor" id="line-54"></span><p class="line862">File/directory attribute changes</td>
  <td><p class="line862">For executable flag changes, acts a file replacement.  Otherwise, no similar record.</td>
</tr>
</tbody></table></div><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line862">Another notable difference is that Vesta only stores directory changes as a strict tree, whereas monotone stores revisions as a <a class="http" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a>.  Vesta's filesystem approach is apparent here: a single delta representation over a single earlier version is sufficient to represent the contents of an immutable directory.  In contrast, when a merge occurs monotone records two different set of changes in the revision record, one for each of the versions being merged. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">A subtler difference is that in the Vesta repository internally there's no difference between an immutable directory that's a sub-directory of a particular version and the immutable directory representing an entire version.  (There are even some tricks which take advantage of this: <a href="../RepositoryTricks/SubdirOldVer.html">RepositoryTricks/SubdirOldVer</a>, <a href="../RepositoryTricks/LinkIntoWorkDir.html">RepositoryTricks/LinkIntoWorkDir</a>.)  In other words, <em>Vesta has no data structure to represent the entire <a class="http" href="../../vesta/doc/man/html/vesta-intro.1.html#package">package</a></em>.  In contrast, monotone revisions and manifests are concerned with the entire directory tree for the revision in question.  This helps facilitate merging directory structure changes as the revision-level data structure can record &quot;<strong>a/b</strong> was renamed to <strong>c/d</strong>&quot;.  In Vesta we've <a class="https" href="https://sourceforge.net/tracker/index.php?func=detail&amp;aid=1195227&amp;group_id=34164&amp;atid=410430">discussed a mechanism for storing that information as attributes on a revision</a>, but I no longer think that's a viable approach.  The rename information really needs to be stored immutably and in such a way that it is indivisible from the rest of the changes. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line862">While Vesta can refer to revisions by 128-bit fingerprints, they are more often referenced by a canonical path under the <tt>/vesta</tt> virtual filesystem.  This is made portable across repositories through the concepts of mastership and replica agreement.  (See <a class="http" href="../../vesta/doc/man/html/vrepl.1.html#Vesta_Replication">&quot;Vesta Replication Design&quot; on the vrepl man page</a> and <a class="http" href="http://gatekeeper.research.compaq.com/pub/DEC/SRC/research-reports/abstracts/src-rr-172.html">&quot;Partial Replication in the Vesta Software Repository&quot;</a>.)  Furthermore, the fingerprints of individual revisions are usually assigned by fingerprinting the text of the canonical path where they were first inserted into the repository (normally with vadvance) rather than by their contents.  In contrast, monotone only refers to revisions by their SHA1 hash, and the SHA1 has is computed from the contents of the revision record. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867">
<h1 id="Revision_Attributes">Revision Attributes</h1>
<span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line867">
<h2 id="Similarities-2">Similarities</h2>
<span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">Both systems allow essentially arbitrary name/value pairs to be associated with revisions.  Both use these for storing informaiton like authorship and checkin comments. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line867">
<h2 id="Differences-2">Differences</h2>
<span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line862">Montone stores such data as <a class="http" href="http://venge.net/monotone/docs/Certificates.html">cryptographically signed certificates</a>.  This means that each one is verifiably added by a particular user, which makes for a useful audit trail. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line862">Vesta stored them as <a class="http" href="../../vesta/doc/man/html/vesta-intro.1.html#mutable_attributes">mutable attributes</a>.  While a history of attribute changes is retained, the user responsible for attribute changes is not traceable. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><p class="line867">
<h1 id="Merge_Technology">Merge Technology</h1>
<span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867"><span class="anchor" id="mark_merge"></span> <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867">
<h2 id="Mark_Merge">Mark Merge</h2>
<span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line862">The monotone developers have done a fairly substantial redesign of their algorithms for merging directory structure changes.  The current implementation is based on an idea called <a class="interwiki" href="http://revctrl.org/MarkMerge" title="Revctrl">MarkMerge</a>.  This is a promising area for investigation and possible adaptation for use in Vesta. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line874">To facilitate the mark merge algorithm, montone currently stores with each revision the &quot;marked&quot; parent revisions for each path change (rename) and each content change (file edit).  These are stored in what monotone calls a &quot;roster&quot;, which is essentially a manifest plus additional information.  This avoid the need to traverse the revision DAG on a merge operation, though it does take up additional space. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line874">Monotone's rosters also store a unique ID with each file/directory.  This is assigned when the file/directory is created and follows it through any renaming.  This makes several other operations by again avoiding the need to traverse history.  For example, two rosters can be compared to determine the set of changes required to turn one into another, including renaming.  Also, when performing a merge operation it's trivial to find the current location of a file/directory regardless of how many times it has been renamed. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line874">It's worth mentioning that the marked revisions and file/directory node IDs stored in the rosters are purely an optimization.  They could be recomputed by traversing the history.  Also, this information is purely local to each monotone DB; it is not transmitted when communicating with peer DBs in push/pull/sync operations. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line867">
<h3 id="Roster_Example">Roster Example</h3>
<span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line874">Here's an example stanza from a monotone roster: <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line867"><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><pre><span class="anchor" id="line-1"></span>        file &quot;botan/mem_pool.cpp&quot;
<span class="anchor" id="line-2"></span>     content [cc2313bdb2ed78668efea720ddd78929c8afb461]
<span class="anchor" id="line-3"></span>       ident &quot;2656&quot;
<span class="anchor" id="line-4"></span>       birth [b2a85983739b31bd01969cc21d510a2c9a656252]
<span class="anchor" id="line-5"></span>   path_mark [b2a85983739b31bd01969cc21d510a2c9a656252]
<span class="anchor" id="line-6"></span>content_mark [2e68909d3d85d4fbc8a2481c1b3158a138e4d45f]
<span class="anchor" id="line-7"></span>content_mark [53785231cf54192a449c378a6120313b3e842890]</pre><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line874">Things to note: <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><ul><li>It's birth revision and path_mark revision are the same.  This tells us that it hasn't been renamed since it was initially created. <span class="anchor" id="line-105"></span></li><li><p class="line862">It has two different content_mark revisions.  (<a class="http" href="http://article.gmane.org/gmane.comp.version-control.revctrl/93">See the description of multi-mark-merge for how this can happen.</a>) <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span></li></ul><p class="line867">
<h2 id="File_Life-cycle">File Life-cycle</h2>
<span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line874">In monotone, in a given revision a file (or a directory) can be in exactly one of three states: <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><ol type="1"><li><p class="line891"><strong>Unborn</strong>: the file has not yet been created (e.g. it's creation is in some future revision or in a different branch) <span class="anchor" id="line-112"></span></li><li><p class="line891"><strong>Alive</strong>: the file exists (it was created in some ancestor revision and has not been deleted) <span class="anchor" id="line-113"></span></li><li><p class="line891"><strong>Dead</strong>: the file has been deleted (in this revision or some ancestor of it) <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span></li></ol><p class="line862">As history advances, files can only ever change from <strong>Unborn</strong> to <strong>Alive</strong> and from <strong>Alive</strong> to <strong>Dead</strong>.  That is, once a file has been deleted it stays deleted forever.  There is no way to &quot;resurrect&quot; a deleted file.  If a file with the same name is created in a later revision, it is a different file (i.e. has a different file ID). <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">This approach, which is used by other systems, is sometimes called <a class="interwiki" href="http://revctrl.org/DieDieDieMerge" title="Revctrl">DieDieDieMerge</a>.  It's a useful simplification, both for the implementation and for the user, but it has some implications which are worth mentioning: <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><ul><li><p class="line862">A file deletion in any branch dominates when merging.  That is, if user <strong>A</strong> modifies a file and user <strong>B</strong> deletes the file and they merge, the result is that the file is deleted.  (In fact, monotone will currently silently drop the changes made in parallel to the deletion, though it would be possible to detect that and warn about it.) <span class="anchor" id="line-120"></span></li><li>If a file with a particular name is deleted and re-created, because its unique file ID is different they are treated like two different files.  Changes made to the old file will never be merged into the new file. <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></li></ul><p class="line874">I believe that some other systems support resurrecting a deleted file, but that has some implementation complications which the method used by monotone avoids.  (For example, if there are multiple un-merged variants of a file before it gets deleted, all of those different file contents would need to be remembered and merged if the file is ever resurrected.) <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line867">
<h2 id="Directory_Structure_Conflicts">Directory Structure Conflicts</h2>
<span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line874">Monotone has arguably one of the more sophisticated systems for tracking and merging directory structure changes.  Here are the kinds of conflicts their directory structure merger can recognize: <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><ul><li><p class="line862">Name conflict: File/directory has two different names.  Caused by merging &quot;rename <tt>A</tt>-&gt;<tt>B</tt>&quot; with &quot;rename <tt>A</tt>-&gt;<tt>C</tt>&quot;. <span class="anchor" id="line-129"></span></li><li><p class="line862">Rename target conflict: Two different files/directories renamed to the same name.  Caused by merging &quot;rename <tt>A</tt>-&gt;<tt>B</tt>&quot; with &quot;rename <tt>C</tt>-&gt;<tt>B</tt>&quot;. <span class="anchor" id="line-130"></span><ul><li>Note that this also covers an unusual case where there are two distinct directories which are both trying to become the project root. <span class="anchor" id="line-131"></span></li></ul></li><li><p class="line862">Orphaned node: Parent directory no longer exists.  Caused by merging &quot;create <tt>A/B</tt>&quot; with &quot;rmdir <tt>A</tt>&quot;. <span class="anchor" id="line-132"></span></li><li><p class="line862">Directory loop: Combining two renames would create a directory loop.  Caused by merging &quot;rename <tt>A</tt>-&gt;<tt>B/A</tt>&quot; with &quot;rename <tt>B</tt>-&gt;<tt>A/B</tt>&quot;. <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span></li></ul><p class="line874">There are also some other more monotone-specific conflicts that come out of the same merge algorithm: <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><ul><li><p class="line862">Illegal name: Trying to place a file/directory with the reserved name &quot;<tt>_MTN</tt>&quot; in the project root.  I believe this can be caused by merging the creation of that name in a subdirectory with an operation which changes which directory is the project root. <span class="anchor" id="line-137"></span></li><li>Node attribute conflict: Monotone allows arbitrary attributes to be attached to versioned files, and changes to those attributes are versioned and merged.  This can produce conflicts as well. <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span></li></ul><p class="line867">
<h2 id="Pluck">Pluck</h2>
<span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line862">monotone also has a feature called <a class="http" href="http://www.venge.net/monotone/docs/Workspace.html#index-mtn-pluck-_002d_002drevision_003d_0040var_007bfrom_007d-_002d_002drevision_003d_0040var_007bto_007d-39">pluck</a> which may be worth adapting.  It does its best to intelligently apply changes in a different context from the one in which they were originally created. <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line874">It works by creating a fake revision graph that looks like this: <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867"><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><img src="Monotone%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-88c1a03cb76984b9e541a2961cbe72c21ce09358.png" /><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><p class="line874">It then performs a merge operation to create a new fake revision: <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><p class="line867"><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><img src="Monotone%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-779abbcd9a6966d649fd46fd675fae1ae09fd996.png" /><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line874">It then applies changes to transform the working copy into <span class="anchor" id="line-171"></span>the merged state. <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line862">This uses montone's normal <a class="interwiki" href="http://revctrl.org/MarkMerge" title="Revctrl">MarkMerge</a> code and its directory structure merging and conflict resolution but in a somewhat degenerate way as this really just a 3-way merge (treating the &quot;from&quot; revision as the common ancestor). <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line874">This is enabled by monotone's roster format and its tracking file/directory identity.  This makes it possible to construct the fake revision graph by directly comparing the &quot;from&quot; state with both the &quot;to&quot; state and the working copy to get two sets of changes to combine. <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line867">
<h1 id="Other_Random_Observations">Other Random Observations</h1>
<span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line867"><a class="http" href="http://oandrieu.nerim.net/monotone-viz/">monotone-viz</a> is a very cool way to look at history in monotone.  If there's a single GUI I'd want to steal, that would be it. <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line862">A number of the things I've written about (<a href="../vupdateandbranches.html">vupdateandbranches</a>) and <span class="anchor" id="line-182"></span>even implemented in scripts (<a href="../DevelopingVesta/BranchStatus.html">DevelopingVesta/BranchStatus</a>) seem to me <span class="anchor" id="line-183"></span>like they're reaching for something more like monotone's concept of <span class="anchor" id="line-184"></span>branches and automatically finding the current heads.  However, I <span class="anchor" id="line-185"></span>would mention that finding the current heads of a branch in a <span class="anchor" id="line-186"></span>significant repository does seem to have a noticeable time cost. <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><p class="line874">The output of &quot;mtn status&quot; is kind useful in that it tells you about  <span class="anchor" id="line-189"></span>everything which has changed since the previous revision.  It's a  <span class="anchor" id="line-190"></span>little more readable than the output of &quot;vdiff -q&quot;, which is what I  <span class="anchor" id="line-191"></span>tend to use for that.  It wouldn't be hard to write a utility that did  <span class="anchor" id="line-192"></span>something more like &quot;mtn status&quot; for a Vesta working directory.  <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line874">One thing that strikes me as really convenient about the monotone UI <span class="anchor" id="line-195"></span>is that it remembers the last value you used for quite a few things <span class="anchor" id="line-196"></span>(database, remote server for sync, branch to commit to or sync, etc.) <span class="anchor" id="line-197"></span>and makes those the default for subsequent operations.  Off the top of <span class="anchor" id="line-198"></span>my head I'm not sure what we could automatically remember in that way, <span class="anchor" id="line-199"></span>but it's a neat trick. <span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><p class="line874">Another nice thing: you can supply a checkin comment before commit by <span class="anchor" id="line-202"></span>sticking it in the file &quot;<tt>_MTN/log</tt>&quot;.  You could sort of do that <span class="anchor" id="line-203"></span>by changing the &quot;message&quot; attribute on a version reservation stub, but <span class="anchor" id="line-204"></span>it's not that easy to edit attribute values.  Hmm... maybe <span class="anchor" id="line-205"></span><a class="http" href="../../vesta/doc/man/html/vattrib.1.html">vattrib</a> could <span class="anchor" id="line-206"></span>have a mode where it invoked <tt>$EDITOR</tt> to let you edit an <span class="anchor" id="line-207"></span>attribute value, though I don't know how you would handle <span class="anchor" id="line-208"></span>multiply-valued attributes. <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><p class="line862">Monotone includes code in its scripting extension lanague (<a class="http" href="http://www.lua.org/">Lua</a>) to invoke several different interactive merging/conflict resolution tools including: <span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><ul><li>Invoking Emacs with its ediff mode <span class="anchor" id="line-213"></span></li><li>Invoking vim in its diff mode <span class="anchor" id="line-214"></span></li><li><p class="line891"><a class="http" href="http://meld.sourceforge.net/">meld</a> <span class="anchor" id="line-215"></span></li><li><p class="line891"><a class="http" href="http://furius.ca/xxdiff/">xxdiff</a> <span class="anchor" id="line-216"></span></li><li><p class="line891"><a class="http" href="http://kdiff3.sourceforge.net/">kdiff3</a> <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span></li></ul><p class="line862">If the user doesn't explicitly specify which of these tools they would like to use, the Lua code tries to make an educated guess based on the <tt>$EDITOR</tt> environment variable (picking either Emacs or vim). <span class="anchor" id="line-219"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

