<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>BridgelessVesta - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: BridgelessVesta" href="BridgelessVesta%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=BridgelessVesta&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="BridgelessVesta%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="BridgelessVesta%3Faction=print.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="BridgelessVesta.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="BridgelessVesta.html">BridgelessVesta</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="BridgelessVesta.html">BridgelessVesta</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="BridgelessVesta%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="fr" dir="ltr">
<div dir="ltr" id="content" lang="fr"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h2 id="Bridgeless_Vesta">Bridgeless Vesta</h2>
<span class="anchor" id="line-4"></span><p class="line867"><strong>AKA Thin Bridge</strong> <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line874">The theory is that if you didnt have to learn about bridges, and you needed to learn minimal SDL, the ramp to learning vesta would be much smaller. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line874">Thus i propose a bridgeless methodology. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line874">In this mode, what these people would be doing is populating vesta with the tools they need -- in a directory structure copied from what they already do in linux.  then it should be something trivial to convert that into a binding w/ the same hier and put that in root to the temporary encapsulated root filesystem (TERFS) w/ the same hier.  The point here is that once they start executing run_tool() funcs, the terfs env looks the same to them as their regular unix env. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line874">Then there's some relatively trivial code to move input files into the terfs and result files out, but that's boilerplate. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line862">I am explicitly suggesting that we <strong>give up</strong> the benefit of portability (but see below) that we get with bridges, to lessen -- perhaps dramatically -- the ramp to get these benefits of vesta: <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><ol type="1"><li>reproducibility <span class="anchor" id="line-17"></span></li><li>cached results <span class="anchor" id="line-18"></span></li><li>shared build products <span class="anchor" id="line-19"></span></li><li>auto-snapshot work areas. <span class="anchor" id="line-20"></span></li><li>explicit versioning (no &quot;ground pulled out from under you&quot; syndrome) <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></li></ol><p class="line874">That seems like a lot! <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867">
<h3 id="Steps_to_adding_a_flow_in_Bridgeless_Vesta">Steps to adding a flow in Bridgeless Vesta</h3>
<span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line862">It could be that the steps below could be done automatically.  See <a href="CrudeToolImport.html">CrudeToolImport</a>. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">Manually: <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><ol type="1"><li><p class="line862">pick a location in the repository, eg, <tt>/vesta/my.domain.com/play/$USER/mynewflow/</tt> eg <tt>/vesta/mmdc1.intel.com/play/jvkumpf/mynewflow/</tt>. <span class="anchor" id="line-32"></span></li><li><p class="line891"><tt>mkdir&nbsp;/vesta/mmdc1.intel.com/play/jvkumpf/mynewflow/</tt>. <span class="anchor" id="line-33"></span></li><li><p class="line891"><tt>vcreate&nbsp;/vesta/mmdc1.intel.com/play/jvkumpf/mynewflow/pkg/</tt>. <span class="anchor" id="line-34"></span></li><li><p class="line891"><tt>mvco&nbsp;/vesta/mmdc1.intel.com/play/jvkumpf/mynewflow/pkg/</tt>. <span class="anchor" id="line-35"></span></li><li><p class="line862">in <tt>/vest-work</tt> copy <tt>build.ves</tt> from the template <span class="anchor" id="line-36"></span></li><li><p class="line862">add tools to <tt>/vesta/mmdc1.intel.com/play/bridgelessvesta/path/bin/</tt> it <tt>/vesta/mmdc1.intel.com/play/bridgelessvesta/path/bin/newtool/pkg/</tt>. <span class="anchor" id="line-37"></span><ul><li><p class="line862">under <tt>bridgelessvesta/path/bin/</tt> is <tt>/bin</tt>, <tt>/usr/bin</tt>, <tt>/usr/local/bin</tt> etc <span class="anchor" id="line-38"></span></li><li><p class="line862">every tool gets its own <tt>pkg</tt>.  So the hierarchy is just like unix, but with an extra <tt>pkg/N</tt> level inserted to do the versioning <span class="anchor" id="line-39"></span></li></ul></li><li><p class="line862">boilerplate imports of things from <tt>/bin</tt> including perl, awk, grep, sh, csh, whatever <span class="anchor" id="line-40"></span></li><li><p class="line891"><tt>files</tt> clause to include input files <span class="anchor" id="line-41"></span></li><li><p class="line891"><tt>files</tt> clause to include any user-specific scripts <span class="anchor" id="line-42"></span></li><li>assemble command line from strings, directly calling tools <span class="anchor" id="line-43"></span></li><li><p class="line862">call <tt>_run_tool()</tt> or thin bridge version of run_tool() <span class="anchor" id="line-44"></span></li><li><p class="line862">extract results from <tt>_run_tool()</tt>'s return binding (boilerplate) <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></li></ol><p class="line867">
<h3 id="Open_Issues">Open Issues</h3>
<span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line862">1. should we open up people's existing flow scripts and pull out the steps and write them as separate <tt>_run_tool()</tt> calls, or just call the multi-step perl or csh or sh script with a single <tt>_run_tool()</tt> call?  Why or why not? <span class="anchor" id="line-49"></span><ul><li>adv separate: each tool call can be cached seperately <span class="anchor" id="line-50"></span></li><li>adv single: less sdl to write <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></li></ul><p class="line862">2. should this template/boilerplate <tt>build.ves</tt> file call <tt>_run_tool()</tt> directly, or should it call a thin bridge which just takes its inputs and then calls <tt>_run_tool()</tt>? <span class="anchor" id="line-53"></span><ul><li>adv thin bridge: the thin bridge version would allow the passing of strings, instead of making the user pass a list of strings, forcing them to learn, at least a little, the SDL list syntax. <span class="anchor" id="line-54"></span></li><li>adv directly: the thing bridge would complicate the template because the thin bridge would have to be imported.  If this is all boilerplate, then maybe this disadv doesnt matter. <span class="anchor" id="line-55"></span></li><li>adv thin bridge: the thin bridge gives an opportunity for porting or other helps later on <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span></li></ul><p class="line862">3. (Someone knows the answer to this, just not me) What is the &quot;cost&quot; of putting a lot of files, like 1000s in the TERFS.  I do not believe they are copied in there, but rather just vesta api references to the permanent sid storage.  So the cost of, for example, populating <em>every</em> <tt>_run_tool()</tt> call, automatically, with everything in the typical user's path, would be the cost of creating (ok now were at) 10k of these references (i like to call them soft links, but i know they're not). <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line867">
<h3 id="Portability">Portability</h3>
<span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line862">Do we really give up portability?  Perhaps not.  A <tt>build.ves</tt> file which contains explicit calls to <tt>_run_tool()</tt> with explicit strings and switches and pathnames -- coupled with some knowledge that this runs on a particular version of linux/gnu/gcc/etc, becomes an <em>abstract</em> description of what that <tt>build.ves</tt> file should do.  Ie, a specific detailed script applied to a specific version of the platform describes an abstract step. <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line862">It should be theoretically possible, then, to port this <tt>build.ves</tt> file to another platform, or, better said, run this <tt>build.ves</tt> file on another platform, w/o editing the <tt>build.ves</tt> file by passing it thru a translation layer, that interprets its fixed strings against its target platform, infers from that the meaning and goal of the command and/or option, and creates the equivalent on the new platform. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line862">If this ideas is implemented with a &quot;thin bridge&quot; which just takes its inputs and calls <tt>_run_tool()</tt> directly, then the thin bridge is a great place to intercept the call and translate to another platform. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867">
<h1 id="What.27s_so_hard_about_writing_bridges.3F">What's so hard about writing bridges?</h1>
<span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line874">There are several things which make writing bridges hard: <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><ol type="1"><li><p class="line891"><strong>Setting up the encapsulated filesystem.</strong>  99% of UNIX users have never set up a chroot environment.  It's not easy.  Just getting your head around the idea of chroot, the fact that you have to provide all the files and that you can put in any files in any arrangement you want, is difficult for most people.  Even once they understand that, they may not know all the files they need, and discovering the complete set can be difficult. <span class="anchor" id="line-72"></span></li><li><p class="line891"><strong>Setting up the environment variables.</strong>  99% of UNIX users don't think about which environment variables a given command they type depends upon.  They just have some shell startup scripts that set some for them, and they get inherited by every process they run.  Starting with no environment variables forces you to know every one you need.  Often this can be poorly documented and otherwise difficult to find out. <span class="anchor" id="line-73"></span></li><li><p class="line891"><strong>SDL the language.</strong>  It's peculiar to Vesta.  It's functional which many people find strange.  It has data types which people aren't familiar with (bindings).  It treats functions as first class values, which people also often find strange. <span class="anchor" id="line-74"></span></li><li><p class="line891"><strong>Abstraction and generalization.</strong>  UNIX users are used to thinking in terms of individual command lines they type at a shell prompt.  However most build processes that users would write up in SDL they'll want to re-use at some point.  That means abstracting them in some way, making it possible to substitute in different pieces (different source files, different command-line arguments, different versions of the executable software).  That's what a &quot;bridge&quot; is: an abstracted, generalized way of running one or processes. <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span></li></ol><p class="line867">
<h3 id="How_do_the_suggestions_above_simplify_this.3F">How do the suggestions above simplify this?</h3>
<span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line862">People <strong>do</strong> write SDL like what's described above (straight-line code that sets up filesystems and environment variables and calls <tt>_run_tool</tt> one or more times with hard-coded sources/executables).  That's usually the <em>first step</em> towards writing a bridge. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line862">It seems to me (<a href="KenSchalk.html">KenSchalk</a>) that the only effort the approach this page is talking about saves is item #4 on the list above (abstraction and generalization).  Setting up the filesystem and environment variables may still be hard (depending on the tool).  Learning SDL is still a hurdle, though maybe you can get away with doing <em>less</em> in the language if you're just writing straight-line code. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867">
<h3 id="Specific_responses">Specific responses</h3>
<span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><ul><li style="list-style-type:none">In this mode, what these people would be doing is populating vesta with the tools they need -- in a directory structure copied from what they already do in linux.  then it should be something trivial to convert that into a binding w/ the same hier and put that in root to the temporary encapsulated root filesystem (TERFS) w/ the same hier. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span></li></ul><p class="line874">Sure, that's easy: <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line867"><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><pre><span class="anchor" id="line-1"></span>% cd /vesta-work/jsmith/foo
<span class="anchor" id="line-2"></span>% mkdir root
<span class="anchor" id="line-3"></span>[copy files into the root subdirectory]
<span class="anchor" id="line-4"></span>% cat &gt; build.ves
<span class="anchor" id="line-5"></span>files
<span class="anchor" id="line-6"></span>  root;
<span class="anchor" id="line-7"></span>{
<span class="anchor" id="line-8"></span>  . ++= [ root ];
<span class="anchor" id="line-9"></span>  // ...
<span class="anchor" id="line-10"></span>}</pre><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><ul><li style="list-style-type:none">the thin bridge version would allow the passing of strings, instead of making the user pass a list of strings, forcing them to learn, at least a little, the SDL list syntax. <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span></li></ul><p class="line874">How do you parse that into separate strings to make the command line?  What if the user tries to put a string in quotes on the command line?  Do you pass the command-line to a shell to be interpreted?  If so which one (csh, tcsh, bash, sh, etc.)? <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><ul><li style="list-style-type:none">What is the &quot;cost&quot; of putting a lot of files, like 1000s in the TERFS. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span></li></ul><p class="line862">You're correct, the files are not copied in any way.  They're not link symbolic links (<tt>ln&nbsp;-s</tt>), they're more like hard links (<tt>ln</tt>), but that's really just an analogy. <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line862">The temporary filesystem only exists in the memory of the evaluator <em>until the tool access it</em>.  Whenever the tool tries to access some file/directory, the repository <em>calls back</em> the evaluator to get information about the file/directory being accessed. <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line874">So, the &quot;costs&quot; to consider are: <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><ol type="1"><li><p class="line862">Time to construct the <tt>./root</tt> binding in SDL (there are some ways that are faster than others). <span class="anchor" id="line-114"></span></li><li><p class="line862">Memory in the evaluator to hold the <tt>./root</tt> binding <span class="anchor" id="line-115"></span></li><li>Number and latency of network transactions to access each file/directory: from the host running tool to the repository (NFS), and from the repository back to the evaluator (SRPC). <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></li></ol><p class="line862">Also, how you organize files in the <tt>./root</tt> may matter in some cases.  Suppose, for example, that you have a tool which lists the entire contents of the current working directory (typically <tt>./root/.WD</tt> in SDL).  If you put lots of extra files in there, the network transactions to list the directory will take longer. <span class="anchor" id="line-118"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

