<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>ScalingUp - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: ScalingUp" href="ScalingUp%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=ScalingUp&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="ScalingUp%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="ScalingUp%3Faction=print.html">
<link rel="Appendix" title="autogenerated-3d5e721c72c81af1cadf109ca68cfb76de0cd27f.png" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-3d5e721c72c81af1cadf109ca68cfb76de0cd27f.png.html">
<link rel="Appendix" title="autogenerated-7ebabae070133472bee3b1fdf34be426a7d931a5.png" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-7ebabae070133472bee3b1fdf34be426a7d931a5.png.html">
<link rel="Appendix" title="autogenerated-80982ff1d48d36c966473e8c6bf47deee424d210.png" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-80982ff1d48d36c966473e8c6bf47deee424d210.png.html">
<link rel="Appendix" title="autogenerated-9b585b747d3410ee8cbe987ae146d7c0de867482.png" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-9b585b747d3410ee8cbe987ae146d7c0de867482.png.html">
<link rel="Appendix" title="autogenerated-adc0376cb5b19b7949513772353dd274223885f4.png" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-adc0376cb5b19b7949513772353dd274223885f4.png.html">
<link rel="Appendix" title="delete.me.to.regenerate.images" href="ScalingUp%3Faction=AttachFile&amp;do=view&amp;target=delete.me.to.regenerate.images.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="ScalingUp.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="ScalingUp.html">ScalingUp</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="ScalingUp.html">ScalingUp</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="ScalingUp%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="ScalingUp.html#NFS_Traffic_From_Tools">NFS Traffic From Tools</a></li><li>
<a href="ScalingUp.html#NFS_Traffic_Reading_Build_Results">NFS Traffic Reading Build Results</a><ol><li>
<a href="ScalingUp.html#Peer-to-peer_Shortids">Peer-to-peer Shortids</a></li><li>
<a href="ScalingUp.html#Split_Shortid_Pool_Across_Multiple_Servers">Split Shortid Pool Across Multiple Servers</a></li></ol></li><li>
<a href="ScalingUp.html#Related_Projects">Related Projects</a></li></ol></div> <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h1 id="NFS_Traffic_From_Tools">NFS Traffic From Tools</h1>
<span class="anchor" id="line-7"></span><p class="line874">Builds can run many tools in parallel.  Lots of users can each run builds with many parallel tools.  All that I/O traffic has to go through the repository server. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">It would be preferable to distribute it.  Each RunToolServer could be responsible for serving the volatile directories for its own tool runs.  This could also make the tool I/O faster by having it serviced locally.  However it would create a problem of getting the derived files produced by each tool run back to the central store. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867">
<h1 id="NFS_Traffic_Reading_Build_Results">NFS Traffic Reading Build Results</h1>
<span class="anchor" id="line-12"></span><p class="line874">We've recently been having difficulty in this area at Intel.  Our builds have tens of thousands of result files.  Users often ship a build result as symlinks and then run a series of tests on the build result as batch jobs across a collection of clients.  These all reach into the shortid pool and have been putting significant loads on the kernel NFS server.  With hundreds of users and thousands of clients running batch jobs using build results, this can reach the point that it degrades the performance of the whole system. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line874">It would be preferable to distribute the load for accessing build results across multiple machines. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line867">
<h2 id="Peer-to-peer_Shortids">Peer-to-peer Shortids</h2>
<span class="anchor" id="line-17"></span><p class="line874">Multiple clients are already reading the files from the server and storing them in their local NFS client cache, but this only helps each individual client.  With some work, we could make our own caching layer which makes it possible for clients to serve immutable shortids to each other in a &quot;peer-to-peer&quot; style.  This would make the system scale with the number of client hosts running such a caching agent. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line874">If we used this same caching layer with volatile directories, then the client which ran the build step which produced a derived file would already have a copy of that derived file ready to be delivered to a peer.  To put it another way, building itself would &quot;seed&quot; the peer-to-peer network. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">For more on this see <a href="ScalingUp/PeerToPeerDesign.html">/PeerToPeerDesign</a>. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Split_Shortid_Pool_Across_Multiple_Servers">Split Shortid Pool Across Multiple Servers</h2>
<span class="anchor" id="line-24"></span><p class="line874">There is another possible other way to implement load sharing for the shortid pool that requires a fair bit more infrastructure, but less development work.  In an environment that already has many different NFS file servers there are a couple of ways the shortids could be split across them: <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><ul><li>Simply use symbolic links for the top layer of the numbered directories off to NFS hard mounts on different file servers.  Assuming a fast interconnect between the Vesta server and the NFS servers (ideally a separate dedicated network used only between the repository and the other NFS servers), this might not present too much of a performance hit to the clients.  This would require changing the repository's deletion code to not remove empty directories if they happen to be symlinks. <span class="anchor" id="line-27"></span></li></ul><p class="line867"><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><img src="ScalingUp%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-9b585b747d3410ee8cbe987ae146d7c0de867482.png" /><span class="anchor" id="line-68"></span><ul><li><p class="line862">Slightly more involved would be using N bits of the shortid space to segment between different file servers.  The repository would still maintain its shortid pool as normal, but an additional SRPC call would be added.  When the evaluator is shipping as links it would find which of those remote pools the link target should live in, create the symlink, and check if the target exists.  If it's not yet present, it would send an SRPC request to the repository which would copy it to the target in a background thread.  <em>(<strong><a href="KenSchalk.html">KenSchalk</a></strong> : I don't think we can do that asynchronously in the background as that would mean when the evaluator is done shipping some of the links might point to non-existent targets or files that have only been partially copied.)</em>  Then when weeding the repository would delete the sid file from both the central pool and the remote mirror.  While this change would be more work, it would allow building to to use the central (presumably fast) sid pool, but still eliminate the load from results shipped as links. <span class="anchor" id="line-69"></span></li></ul><p class="line874">Note that this approach would scale proportional to the number of these separate NFS servers which were introduced. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867">
<h1 id="Related_Projects">Related Projects</h1>
<span class="anchor" id="line-72"></span><p class="line874">While the problems and opportunities represented by Vesta's data distribution needs may be somewhat unique, it would be worth investigating other distributed file system designs: <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><ul><li><p class="line891"><a class="http" href="http://labs.google.com/papers/gfs.html">The Google File System</a> <span class="anchor" id="line-75"></span></li><li><p class="line891"><a class="http" href="http://coda.cs.cmu.edu/">Coda</a> <span class="anchor" id="line-76"></span></li><li><p class="line891"><a class="http" href="http://www.lustre.org/">Lustre</a> <span class="anchor" id="line-77"></span></li><li>CacheFS <span class="anchor" id="line-78"></span><ul><li><p class="line891"><a class="http" href="http://docs.sun.com/app/docs/doc/816-4552/6maoo3124?a=view">Overview from Sun</a> <span class="anchor" id="line-79"></span></li><li><p class="line891"><a class="http" href="http://lwn.net/Articles/100330/">LWN article</a> <span class="anchor" id="line-80"></span></li><li><p class="line891"><a class="http" href="http://people.redhat.com/~dhowells/cachefs/">Code from RedHat</a> <span class="anchor" id="line-81"></span></li><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>) It's not clear to me that the <a class="nonexistent" href="RedHat.html">RedHat</a> one and the Sun one have much in common other than the concept</em> <span class="anchor" id="line-82"></span></li></ul></li><li><p class="line891"><a class="http" href="http://allmydata.org/">AllMyData &quot;Tahoe&quot;</a> <span class="anchor" id="line-83"></span></li><li><p class="line891"><a class="http" href="http://wua.la">Wuala</a> <span class="anchor" id="line-84"></span><ul><li><p class="line891"><a class="http" href="http://www.youtube.com/watch?v=3xKZ4KGkQY8">Google Tech Talk</a> <span class="anchor" id="line-85"></span></li></ul></ul><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

