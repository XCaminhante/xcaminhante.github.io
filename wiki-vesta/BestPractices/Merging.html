<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>BestPractices/Merging - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: BestPractices/Merging" href="BestPractices/Merging?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=BestPractices%2FMerging&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="BestPractices/Merging?action=raw">
<link rel="Alternate" media="print" title="Print View" href="BestPractices/Merging?action=print">
<link rel="Up" href="BestPractices.html">
<link rel="Appendix" title="autogenerated-01a0dec9c15a7f2ed16afd035893824c101f91fd.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-01a0dec9c15a7f2ed16afd035893824c101f91fd.png">
<link rel="Appendix" title="autogenerated-09ae140f94f482b43d5528fe6ccccf8d0e2a6e66.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-09ae140f94f482b43d5528fe6ccccf8d0e2a6e66.png">
<link rel="Appendix" title="autogenerated-14c7b353e561d5d83b97c1d79b08ddee3768619c.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-14c7b353e561d5d83b97c1d79b08ddee3768619c.png">
<link rel="Appendix" title="autogenerated-1e8e10b0e3f20db2f3fc545f17bf45e6859d1651.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-1e8e10b0e3f20db2f3fc545f17bf45e6859d1651.png">
<link rel="Appendix" title="autogenerated-29231aca7df23d94897dc02a0622ab0119c21794.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-29231aca7df23d94897dc02a0622ab0119c21794.png">
<link rel="Appendix" title="autogenerated-3356257e464846ef1a3ae50419d374cc1ecaac6b.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-3356257e464846ef1a3ae50419d374cc1ecaac6b.png">
<link rel="Appendix" title="autogenerated-350eea785449136aeec38acac96c68ebec1075d5.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-350eea785449136aeec38acac96c68ebec1075d5.png">
<link rel="Appendix" title="autogenerated-3ebf71ec09e5f2a1574810dd6751d928efed4fd6.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-3ebf71ec09e5f2a1574810dd6751d928efed4fd6.png">
<link rel="Appendix" title="autogenerated-6e946bfa6025f3a0f831fee122d75f350e6f279d.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-6e946bfa6025f3a0f831fee122d75f350e6f279d.png">
<link rel="Appendix" title="autogenerated-7f570c786c5802fbfcfb6d307683a27f1a18870b.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-7f570c786c5802fbfcfb6d307683a27f1a18870b.png">
<link rel="Appendix" title="autogenerated-8ca14cffc91652193ea9557f0a56f4dbd95ac1c6.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-8ca14cffc91652193ea9557f0a56f4dbd95ac1c6.png">
<link rel="Appendix" title="autogenerated-8d13b9feaf543dfde581f750c4722ca85f9071e8.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-8d13b9feaf543dfde581f750c4722ca85f9071e8.png">
<link rel="Appendix" title="autogenerated-a48dbd192bb08108f12127dff0dfb8c6bc285625.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-a48dbd192bb08108f12127dff0dfb8c6bc285625.png">
<link rel="Appendix" title="autogenerated-a7f60ff47e9348d0cb0f61035459c2233e583b0b.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-a7f60ff47e9348d0cb0f61035459c2233e583b0b.png">
<link rel="Appendix" title="autogenerated-b8f23b76bc7823cc72641f972c43a7cc50723d30.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-b8f23b76bc7823cc72641f972c43a7cc50723d30.png">
<link rel="Appendix" title="autogenerated-c3b4725ddf99120604e11d8a8fc2f93013f3a650.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-c3b4725ddf99120604e11d8a8fc2f93013f3a650.png">
<link rel="Appendix" title="autogenerated-c4f40710ef3912fb8512302c203650726797fb44.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-c4f40710ef3912fb8512302c203650726797fb44.png">
<link rel="Appendix" title="autogenerated-cc70b7a323ac9c49370aabb636d0210bafe9fc58.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-cc70b7a323ac9c49370aabb636d0210bafe9fc58.png">
<link rel="Appendix" title="autogenerated-ce06ede6d38e2dbccce47a829512491e34462c31.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-ce06ede6d38e2dbccce47a829512491e34462c31.png">
<link rel="Appendix" title="autogenerated-d45a193395a7c4e50405c21945a5baebb8e8c87f.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-d45a193395a7c4e50405c21945a5baebb8e8c87f.png">
<link rel="Appendix" title="autogenerated-f442fca6a05f407664419e0131d0b6708961983a.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-f442fca6a05f407664419e0131d0b6708961983a.png">
<link rel="Appendix" title="autogenerated-f8b062c8eba16dad4133245759f6eb1b66f2831f.png" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=autogenerated-f8b062c8eba16dad4133245759f6eb1b66f2831f.png">
<link rel="Appendix" title="delete.me.to.regenerate.images" href="BestPractices/Merging?action=AttachFile&amp;do=view&amp;target=delete.me.to.regenerate.images">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="BestPractices/Merging.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="BestPractices.html">BestPractices</a></li><li><a href="BestPractices/Merging.html">Merging</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="BestPractices/Merging.html">BestPractices/Merging</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="BestPractices/Merging?action=login" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Background">Background</a></li><li>
<a href="#Merging_Advice">Merging Advice</a><ol><li>
<a href="#Resolve_Conflicts_Right_Away">Resolve Conflicts Right Away</a></li><li>
<a href="#Merge_With_Checked-In_Versions">Merge With Checked-In Versions</a></li><li>
<a href="#Either_Merge_or_Edit_During_Each_Checkout.2C_but_not_Both">Either Merge or Edit During Each Checkout, but not Both</a></li><li>
<a href="#Limit_to_One_Merge_per_Checkout">Limit to One Merge per Checkout</a></li><li>
<a href="#Never_Merge_From_Multiple_Sanpshots_in_a_Single_Checkout_Session">Never Merge From Multiple Sanpshots in a Single Checkout Session</a></li><li>
<a href="#Use_Throw-away_Merges_When_Violating_These_Guidelines">Use Throw-away Merges When Violating These Guidelines</a></li></ol></li><li>
<a href="#Specific_Usage_Plans">Specific Usage Plans</a><ol><li>
<a href="#Work_in_Branch.2C_Then_Merge_Up">Work in Branch, Then Merge Up</a><ol><li>
<a href="#Merge_Forward_to_New_Branch">Merge Forward to New Branch</a></li><li>
<a href="#A_Note_About_Sub-Branches">A Note About Sub-Branches</a></li></ol></li><li>
<a href="#Work_in_Non-Exclusive_Checkout.2C_Then_Merge_Up">Work in Non-Exclusive Checkout, Then Merge Up</a><ol><li>
<a href="#Merge_Forward_to_New_Non-Exclusive_Checkout">Merge Forward to New Non-Exclusive Checkout</a></li></ol></li></ol></li><li>
<a href="#A_Small_Cautionary_Note">A Small Cautionary Note</a></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">
<h1 id="Background">Background</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line862">Merging is not yet part of the Vesta core tools.  However, there is <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/beta.vestasys.org/vesta/merging">a prototype merge script</a> that has been in development for a while and is actively used by a variety of people.  This page gives some advice on how best to plan your work around merging and how to avoid potential problems. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line862">In order to understand this page, you should already know the basics of Vesta and <a class="http" href="../vesta/doc/man/html/repos-ui.1.html">the repository tools</a>.  If you don't know: <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><ul><li><p class="line862">The difference between a <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#package">package</a> and a <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#branch">branch</a>, <span class="anchor" id="line-14"></span></li><li><p class="line862">The difference between a <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#session">session directory</a> and a <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#working_directory">working directory</a>, <span class="anchor" id="line-15"></span></li><li><p class="line862">The difference between <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#advance">advancing a snapshot</a> and <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#checkin">checking in a new version</a>, <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></li></ul><p class="line862">Then you should probably back up and start with <a href="LearningVesta.html">LearningVesta</a>, or at least make sure you understand the diagrams on the man pages for <a class="http" href="../vesta/doc/man/html/vcreate.1.html">vcreate</a>, <a class="http" href="../vesta/doc/man/html/vbranch.1.html">vbranch</a>, <a class="http" href="../vesta/doc/man/html/vcheckout.1.html">vcheckout</a>, <a class="http" href="../vesta/doc/man/html/vadvance.1.html">vadvance</a>, and <a class="http" href="../vesta/doc/man/html/vcheckin.1.html">vcheckin</a>. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">For even more information on merging in Vesta, you may also want to look at <a href="MergingFuture.html">MergingFuture</a>. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">For ideas about ways to use branching and merging that are independent of the version control system, you might find <a class="http" href="http://www.cmcrossroads.com/bradapp/acme/branching/">Streamed Lines</a> to be useful. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h1 id="Merging_Advice">Merging Advice</h1>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">This section lists some guidelines which can help you avoid trouble.  They're not hard and fast rules, by they are useful rules of thumb. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line867">
<h2 id="Resolve_Conflicts_Right_Away">Resolve Conflicts Right Away</h2>
<span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">When you perform a merge operation, the merge tool may report conflicts.  These are cases where it felt it could not determine the right choice without human intervention.  Whenever a merge operation results in conflicts, you should resolve them right away.  You should always resolve conflicts before you: <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><ul><li>Check in a new version <span class="anchor" id="line-32"></span></li><li>Perform another merge <span class="anchor" id="line-33"></span></li><li>Perform a build <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></li></ul><p class="line862">Many merge tools (and certainly the <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/beta.vestasys.org/vesta/merging">vmerge script</a>) handle conflicts in text files by placing <em>conflict markers</em> around sections of the files.  Conflict markers usually look like this: <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867"><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><pre><span class="anchor" id="line-1"></span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<span class="anchor" id="line-2"></span>changes
<span class="anchor" id="line-3"></span>made
<span class="anchor" id="line-4"></span>on
<span class="anchor" id="line-5"></span>one
<span class="anchor" id="line-6"></span>side
<span class="anchor" id="line-7"></span>=======
<span class="anchor" id="line-8"></span>mofidications
<span class="anchor" id="line-9"></span>performed
<span class="anchor" id="line-10"></span>in
<span class="anchor" id="line-11"></span>another
<span class="anchor" id="line-12"></span>branch
<span class="anchor" id="line-13"></span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</pre><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line874">This allows you to use you favorite text editor to examine the conflicts and figure out how choose between, combine, or otherwise reconcile them. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line874">The main reason to resolve conflicts right away is to avoid confusion for humans. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><ul><li>If you perform a build using files containing conflicts, you will probably get strange errors as conflict markers are usually not syntactically valid. <span class="anchor" id="line-58"></span></li><li>If you check in a version containing conflicts, you are probably checking in a version that could be considered broken, non-functional, or otherwise wrong.  Most people would consider this poor version control practice. <span class="anchor" id="line-59"></span></li><li>If you perform another merge without first resolving conflicts, you may get interleaved or overlapping conflict regions. <span class="anchor" id="line-60"></span><ul><li>The merge algorithm will not treat the conflict markers specially.  They will appear to it like any other edit a human might make: as lines of text added to the file.  The merge algorithm will not be confused by them.  It will happily produce conflicts over and through the middle of existing conflicts.  This will probably make it much harder for a human to figure out what happened and resolve the conflicts. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></li></ul></li></ul><p class="line867">
<h2 id="Merge_With_Checked-In_Versions">Merge With Checked-In Versions</h2>
<span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line862">When choosing the version to merge into your working directory, you should use a checked in version if at all possible rather than a snapshot in a session directory.  <em>Merging with checked in versions will help avoid conflicts.</em> <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line862">Snapshots in session directories are not part of the normal progression of version history.  To a merge tool, they appear to be separate changes off to the side.  Version N of a package is based on version N-1 of the package.  A snapshot in a session directory is based on a version chosen at checkout time, but usually <em>nothing is based on such snapshots</em>. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line874">The following diagram illustrates what the version history looks like to a merge tool.  Main-line versions (which are good to merge with) are shown in blue, and snapshots in session directories (which you should avoid merging with) are shown in red. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line867"><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><img src="BestPractices/Merging.html?action=AttachFile&amp;do=get&amp;target=autogenerated-1e8e10b0e3f20db2f3fc545f17bf45e6859d1651.png" /><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line862">The important thing to remember about this difference is that <em>merging with snapshots in session directories <strong>makes conflicts on future merges more likely</strong></em>.  See <a href="SessionHistoryMentalModel.html">SessionHistoryMentalModel</a> for more about this. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><p class="line862">The obvious exception to this is if you are merging in changes made in a non-exclusive checkout (aka scribble).  This is fine as long as you <em>only merge from a single snapshot in the session</em>.  Normally, you would <em>merge the last snapshot in the session</em> and you would <em>delete the working directory</em> after performing the merge operation. <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line867">
<h2 id="Either_Merge_or_Edit_During_Each_Checkout.2C_but_not_Both">Either Merge or Edit During Each Checkout, but not Both</h2>
<span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line874">It's easier for everyone to understand the version history if each checkin contains either a new change made by the user or a merge operation.  When you mix the two, it can be difficult to make sense of what happened. <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line874">If you have an active checkout with edits you've been making and you want to perform a merge, check in your changes first and then check out again before merging. <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line874">If you've just done a merge but you're not 100% satisfied with the merged version (maybe you spotted a typo or a logical/semantic error), check in before making further edits.  Of course if the merge produced any conflicts you should resolve those first before checking in.  Also, if the merged version fails to compile or pass tests, you should probably make edits to resolve those problems before checking in.  (In some cases it may be a bit of a judgment call whether an edit is resolving a conflict or other post-merge problem or making a new edit.) <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line867">
<h2 id="Limit_to_One_Merge_per_Checkout">Limit to One Merge per Checkout</h2>
<span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line874">It's easier to understand the version history if you perform and most one merge in each checkout operation.  It is possible to merge multiple merges between checking out and checking in, but it's best to avoid doing so. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line874">Suppose you have two separate changes in two separate branches and you want to merge both of them into the main-line of your package.  This is what you should do: <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><ol type="1"><li>Check out the package main line <span class="anchor" id="line-124"></span></li><li>Merge in the changes from first branch <span class="anchor" id="line-125"></span></li><li>Resolve any merge conflicts <span class="anchor" id="line-126"></span></li><li>Check in the merged version (creating a new version on the main line) <span class="anchor" id="line-127"></span></li><li>Check out the package main line again <span class="anchor" id="line-128"></span></li><li>Merge in the changes from second branch <span class="anchor" id="line-129"></span></li><li>Resolve any merge conflicts <span class="anchor" id="line-130"></span></li><li>Check in the merged version (creating a new version on the main line) <span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span></li></ol><p class="line874">Another reasonable approach would be: <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><ol type="1"><li>Check out the first branch <span class="anchor" id="line-135"></span></li><li>Merge in the changes from second branch <span class="anchor" id="line-136"></span></li><li>Resolve any merge conflicts <span class="anchor" id="line-137"></span></li><li>Check in the merged version (creating a new version on the first branch) <span class="anchor" id="line-138"></span></li><li>Check out the package main line <span class="anchor" id="line-139"></span></li><li>Merge in the changes from first branch (which now includes the changes from the second branch) <span class="anchor" id="line-140"></span></li><li>Resolve any merge conflicts <span class="anchor" id="line-141"></span></li><li>Check in the merged version (creating a new version on the main line) <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span></li></ol><p class="line867">
<h2 id="Never_Merge_From_Multiple_Sanpshots_in_a_Single_Checkout_Session">Never Merge From Multiple Sanpshots in a Single Checkout Session</h2>
<span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line862">If you must merge a snapshot from a checkout session into your working copy, <em>never merge with any other snapshot from that session directory</em>.  Merging with multiple snapshots from the same session directory <em>will make conflicts very likely</em>. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">This is why we recommend that if you are merging in a change from a non-exclusive checkout (sometimes called a &quot;scribble&quot;), that <em>you only merge in the last snapshot in the session</em>.  It might even be a good idea to <em>remove the working directory before you merge</em>. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line862">It's tempting to think of a non-exclusive checkout as a micro-branch, but there are important differences between branches and non-exclusive checkouts.  If your change will go take some time and go through multiple revisions, you may want to use an actual branch (created with <a class="http" href="../vesta/doc/man/html/vbranch.1.html">vbranch</a>).  Again, see <a href="SessionHistoryMentalModel.html">SessionHistoryMentalModel</a> for more about this. <span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line867">
<h2 id="Use_Throw-away_Merges_When_Violating_These_Guidelines">Use Throw-away Merges When Violating These Guidelines</h2>
<span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line874">There may be times when you have a legitimate need to violate these guidelines.  Perhaps you want to try combining several changes that are still works in progress to see how many conflicts they will cause or even to try compiling and testing a preliminary combination.  If you want to do that, do it in a non-exclusive checkout that you use temporarily and then discard. <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line874">As an example, suppose we have several users working on different changes: <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><ul><li><p class="line862">Alice is working on the next main-line version of a package.  Her latest snapshot is <tt>pkg/checkout/15/26</tt>. <span class="anchor" id="line-158"></span></li><li><p class="line862">Bob has a change he's been working on in a branch.  His latest version is <tt>pkg/12.bugfix/3</tt>. <span class="anchor" id="line-159"></span></li><li><p class="line862">Charlie has a small change he's started working on in a non-exclusive checkout (since Alice already had version 15 reserved).  His latest snapshot is <tt>pkg/checkout/14.csmith_example.com.1/32</tt>. <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span></li></ul><p class="line874">Another user, Dave, is going to be responsible for integrating these changes when the three users finish with their work.  He wants to find out how much trouble he's going to have by merging the current state of these three changes.  He performs a non-exclusive checkout: <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line867"><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><pre><span class="anchor" id="line-1-1"></span>% vchekcout -N /vesta/example.com/foo/pkg
<span class="anchor" id="line-2-1"></span>Creating session /vesta/example.com/foo/pkg/checkout/14.djones_example.com.1
<span class="anchor" id="line-3-1"></span>Making working directory /vesta-work/djones/pkg</pre><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line874">He then merges in each of the three versions: <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><ul><li><p class="line862">Merging <tt>pkg/checkout/15/26</tt> produces no conflicts (since Dave made no changes and the basis version is the same) <span class="anchor" id="line-172"></span></li><li><p class="line862">Merging <tt>pkg/12.bugfix/3</tt> may produce some conflicts, which Dave must resolve <span class="anchor" id="line-173"></span></li><li><p class="line862">Merging <tt>pkg/checkout/14.csmith_example.com.1/32</tt> may produce some conflicts, which Dave must resolve <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span></li></ul><p class="line862">After these merges Dave builds and tests the changes, possibly going through more edits.  He notes his final snapshot (<tt>pkg/checkout/14.djones_example.com.1/6</tt>) which may help remind him later how he dealt with certain differences which may come up when he does the real merges.  Then he deletes <tt>/vesta-work/djones/pkg</tt>. <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line867">
<h1 id="Specific_Usage_Plans">Specific Usage Plans</h1>
<span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line874">This section suggests a couple ways to use merging that help you follow the above guidelines and keep out of trouble. <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line867">
<h2 id="Work_in_Branch.2C_Then_Merge_Up">Work in Branch, Then Merge Up</h2>
<span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><p class="line874">When you start working on a change, create a branch.  Check it out, make changes, and check it in.  Build and test as appropriate.  Repeat until you (and anyone else involved) are satisfied with the change. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line874">When you're satisfied with your branch, check out the main-line of your package, merge in the latest version from your branch, resolve any conflicts, and check in a new main-line version. <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line874">In the following illustration of this method, the branch is shown in turquoise, and the merge operation is shown as a dashed red arrow. <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><p class="line867"><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-3ebf71ec09e5f2a1574810dd6751d928efed4fd6.png" /><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><p class="line874">This is the pattern we follow for development of Vesta itself. <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><p class="line867">
<h3 id="Merge_Forward_to_New_Branch">Merge Forward to New Branch</h3>
<span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><p class="line874">If the main-line gets significantly ahead of the point where your branch started, you can merge newer main-line versions down into your branch. <span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><p class="line867"><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-c4f40710ef3912fb8512302c203650726797fb44.png" /><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line874">However you might find that it's easier to understand the version history if you create a new branch and merge the changes from your older branch forward. <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><p class="line867"><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-cc70b7a323ac9c49370aabb636d0210bafe9fc58.png" /><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><p class="line867">
<h3 id="A_Note_About_Sub-Branches">A Note About Sub-Branches</h3>
<span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><p class="line874">Since you can create branches inside branches, you could use this to further sub-divide really complex changes and merge them up just one level (from a sub-branch into a branch). <span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><p class="line867"><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-6e946bfa6025f3a0f831fee122d75f350e6f279d.png" /><span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><p class="line867">
<h2 id="Work_in_Non-Exclusive_Checkout.2C_Then_Merge_Up">Work in Non-Exclusive Checkout, Then Merge Up</h2>
<span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><p class="line874">When you start working on a change, do it in a new non-exclusive checkout (aka scribble).  When you're satisfied with your changes, take a final snapshot of your working directory and remove it.  Then exclusively check out the main-line of your package, merge in the latest snapshot from your non-exclusive checkout, resolve any conflicts, and check in the new main-line version. <span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><p class="line867"><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-ce06ede6d38e2dbccce47a829512491e34462c31.png" /><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><p class="line874">This model is essentially the way CVS works. <span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span><p class="line867">
<h3 id="Merge_Forward_to_New_Non-Exclusive_Checkout">Merge Forward to New Non-Exclusive Checkout</h3>
<span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><p class="line874">If the main-line gets significantly ahead of the point where your non-exclusive checkout started, you may want to create a new non-exclusive checkout and merge your changes forward into it. <span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><p class="line867"><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span><span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span><span class="anchor" id="line-480"></span><span class="anchor" id="line-481"></span><span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span><img src="BestPractices/Merging?action=AttachFile&amp;do=get&amp;target=autogenerated-350eea785449136aeec38acac96c68ebec1075d5.png" /><span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><p class="line862">(Note that in the above diagram every snapshot in the session directory of the second non-exclusive checkout is shown as being merged with the last snapshot in the first.  That's how the merges would be recorded, and that's how the merge algorithm would perceive the history.  Again, see <a href="SessionHistoryMentalModel.html">SessionHistoryMentalModel</a> for more about this.) <span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><p class="line874">You can also merge newer main-line versions into your non-exclusive checkout, but you will probably find it easier to understand the version history if you merge your changes forwared into a new non-exclusive checkout. <span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><p class="line867">
<h1 id="A_Small_Cautionary_Note">A Small Cautionary Note</h1>
<span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><p class="line874">Automatic merging is an attempt to implement a &quot;do what I mean&quot; algorithm.  We endeavor to make such tools involve the user with merge conflicts when appropriate.  However, there's an inherent tension between the desire to automatically handle as much as possible without involving the user and the desire to avoid mistakes by asking the user to resolve conflicts. <span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><p class="line874">While the results of a conflict-free merge are often considered correct by users, you probably shouldn't trust them implicitly.  You should use at least some method for testing their correctness such as: <span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span><ul><li>Compiling or otherwise processing the merge result through software which will reject invalid inputs <span class="anchor" id="line-498"></span></li><li>Performing other tests on the merge result, such as running test cases using merged source code <span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span></li></ul><p class="line874">Of course, it never hurts to read the diff of the changes made by a merge before checking in. <span class="anchor" id="line-501"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

