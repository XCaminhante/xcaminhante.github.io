<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>BestPractices/AdviceForAdministrators - Vesta Wiki</title>
<script type="text/javascript" src="../moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: BestPractices/AdviceForAdministrators" href="BestPractices/AdviceForAdministrators?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=BestPractices%2FAdviceForAdministrators&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="BestPractices/AdviceForAdministrators?action=raw.html">
<link rel="Alternate" media="print" title="Print View" href="BestPractices/AdviceForAdministrators?action=print.html">
<link rel="Up" href="BestPractices.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="AdviceForAdministrators.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="../wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="BestPractices.html">BestPractices</a></li><li><a href="AdviceForAdministrators.html">AdviceForAdministrators</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="AdviceForAdministrators.html">AdviceForAdministrators</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="BestPractices/AdviceForAdministrators?action=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="AdviceForAdministrators.html#Advice_for_Administrators">Advice for Administrators</a><ol><li>
<a href="AdviceForAdministrators.html#Run_the_weeder_automatically">Run the weeder automatically</a></li><li>
<a href="AdviceForAdministrators.html#Keep_RunToolServer_host_lists_up_to_date">Keep RunToolServer host lists up to date</a></li><li>
<a href="AdviceForAdministrators.html#Auto-generate_alias.2Fgroup_files_for_peer_sites">Auto-generate alias/group files for peer sites</a></li><li>
<a href="AdviceForAdministrators.html#Don.27t_let_people_use_.2Fvesta-work_as_a_general_scratch_area">Don't let people use /vesta-work as a general scratch area</a></li></ol></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867">
<h1 id="Advice_for_Administrators">Advice for Administrators</h1>
<span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">This section is a collection of advice for Vesta administrators. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867">
<h2 id="Run_the_weeder_automatically">Run the weeder automatically</h2>
<span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">Build results accumulate until you run <a class="http" href="../../vesta/doc/man/html/VestaWeed.1.html">the weeder</a>.  It's a good idea to arrange for this to be done automatically (e.g. via <tt>cron</tt>) to avoid running out of disk space. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">The Linux installable packages include a simple cron script to run the weeder every week (<tt>/etc/cron.weekly/vestaweed</tt>).  This is probably fine for casual users, but a large installation may need something more.  For example, you might want a script that ran more often (perhaps every hour) and did things like: <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><ul><li>Monitoring free space on the volume(s) where the repository and cache store their data <span class="anchor" id="line-18"></span></li><li>Sending e-mail when free space starts to get low <span class="anchor" id="line-19"></span></li><li>Running weeder automatically if space gets really low <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></li></ul><p class="line867">
<h2 id="Keep_RunToolServer_host_lists_up_to_date">Keep RunToolServer host lists up to date</h2>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line862">The evaluator gets a list of candidate hosts which can run individual build steps from <a class="http" href="../../vesta/doc/man/html/vesta.cfg.5.html">the configuration file</a>.  (See <a class="http" href="../../vesta/doc/man/html/vesta.1.html#runtool">&quot;Runtool Host Selection&quot;</a> in the evaluator man page.)  Each evaluator process will contact the hosts on this list when trying to find a RunToolServer to use.  If one of the hosts is down, or unreachable, or not running a RunToolServer, the evaluator will remember this and will not try to contact it again.  However, there's no way to preserve this information between different builds.  This makes it a good idea to keep the host lists in the configuration file up to date. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">You can automate this with a script to be run via <tt>cron</tt>: <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><ul><li>Get a list of candidate hosts from some known location.  (Hopefully you have a list of all your hosts which might be Vesta clients.) <span class="anchor" id="line-28"></span></li><li><p class="line862">Use the RunToolProbe utility on each candidate host to check for the presence of a RunToolServer.  (The exit status of RunToolProbe indicates whether it was able to contact a RunToolServer on the specified host.) <span class="anchor" id="line-29"></span></li><li><p class="line862">Generate a partial vesta.cfg containing the list of hosts which are up and have RunToolServers to be included by your main vesta.cfg. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span></li></ul><p class="line867">
<h2 id="Auto-generate_alias.2Fgroup_files_for_peer_sites">Auto-generate alias/group files for peer sites</h2>
<span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line874">The repository gets information about all local users and their group memberships from the host operating system.  However, it has no way to automatically get information about remote users and groups.  If you have multiple sites which interact with each other (i.e. by replication and remote checkout/checkin), you'll need to keep peer repositories informed about your users and groups. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line862">You tell the repository about group memberships with its <a class="http" href="../../vesta/doc/man/html/repository.8.html#Group%20file">group file</a>.  You can also tell the repository about user equivalences with its <a class="http" href="../../vesta/doc/man/html/repository.8.html#Aliases%20and%20the%20alias%20file">alias file</a>.  Both of these files allow you to include other files (with &quot;<tt>.&nbsp;otherfile</tt>&quot;). <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">You can write a simple script to generate partial repository alias/group files by reading the OS user/group information (e.g. reading NIS user/group data with ypcat).  You can send these files to peer sites and have them included by the main repository alias/group files. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line862">It's a good idea to automate this.  You'll want to use <a class="http" href="../../vesta/doc/man/html/vaccessrefresh.8.html">vaccessrefresh</a> in such a script to get the repository server to re-read its alias and group files. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line867">
<h2 id="Don.27t_let_people_use_.2Fvesta-work_as_a_general_scratch_area">Don't let people use /vesta-work as a general scratch area</h2>
<span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line862">To inexperienced Vesta users, <tt>/vesta-work</tt> looks like an ordinary NFS disk.  In a large installation, it may have a lot of storage space available.  People may not understand that they shouldn’t use it as a general scratch disk. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line862">Users are able to create directories and store files in <tt>/vesta-work</tt>.  This consumes storage space in the same pool that source files and derived files (build results) are stored in.  The I/O traffic for using <tt>/vesta-work</tt> competes for resources in the repository server with source editing and build doing work. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">Another important issue is that there's no backup in <tt>/vesta-work</tt> (except through <a class="http" href="../../vesta/doc/man/html/vadvance.1.html">vadvance</a>). <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line874">A good rule of thumb is: <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><ul><li style="list-style-type:none"><p class="line862">If you can't vadvance it, it doesn't belong under <tt>/vesta-work</tt> <span class="anchor" id="line-52"></span></li></ul><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

