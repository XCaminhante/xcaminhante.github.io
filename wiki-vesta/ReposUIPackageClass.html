<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>ReposUIPackageClass - Vesta Wiki</title>
<script type="text/javascript" src="moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static199/vesta/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static199/vesta/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static199/vesta/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static199/vesta/css/msie.css">
<![endif]-->


<link rel="alternate" title="Vesta Wiki: ReposUIPackageClass" href="ReposUIPackageClass%3Fdiffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=ReposUIPackageClass&amp;ddiffs=1.html" type="application/rss+xml">


<link rel="Start" href="FrontPage.html">
<link rel="Alternate" title="Wiki Markup" href="ReposUIPackageClass%3Faction=raw.html">
<link rel="Alternate" media="print" title="Print View" href="ReposUIPackageClass%3Faction=print.html">
<link rel="Appendix" title="autogenerated-0f79d505ffddd8b36f914c3a3024432606aaf4c6.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-0f79d505ffddd8b36f914c3a3024432606aaf4c6.png.html">
<link rel="Appendix" title="autogenerated-2a107e331ea6364eecfbd1cd4d95fe58d2433f65.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-2a107e331ea6364eecfbd1cd4d95fe58d2433f65.png.html">
<link rel="Appendix" title="autogenerated-2a5a87a3fc183fd7f5594667e9e31b239e1a0fd5.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-2a5a87a3fc183fd7f5594667e9e31b239e1a0fd5.png.html">
<link rel="Appendix" title="autogenerated-3de9183bb58a9d94eb4a913a43eb483b6cf476e1.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-3de9183bb58a9d94eb4a913a43eb483b6cf476e1.png.html">
<link rel="Appendix" title="autogenerated-46f8f7cf44e0e2cda1f67c58f0f9b6190de3580b.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-46f8f7cf44e0e2cda1f67c58f0f9b6190de3580b.png.html">
<link rel="Appendix" title="autogenerated-78a352a26845d0ec80314c0e073b1b25431213d4.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-78a352a26845d0ec80314c0e073b1b25431213d4.png.html">
<link rel="Appendix" title="autogenerated-84cec9f1d96e7f2d9117bd9ada65a4b4bf0ee094.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-84cec9f1d96e7f2d9117bd9ada65a4b4bf0ee094.png.html">
<link rel="Appendix" title="autogenerated-8c2c2cebf0f64484845edc7cf5fdd5f6fc79f636.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-8c2c2cebf0f64484845edc7cf5fdd5f6fc79f636.png.html">
<link rel="Appendix" title="autogenerated-965cbb20acbdb3215349a8333c8137b56dfe3caf.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-965cbb20acbdb3215349a8333c8137b56dfe3caf.png.html">
<link rel="Appendix" title="autogenerated-a17ba2610b2c27f0a6d2fd78c97685f6a412e975.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-a17ba2610b2c27f0a6d2fd78c97685f6a412e975.png.html">
<link rel="Appendix" title="autogenerated-ecb0c24570c8f20acff8e8d203b2a75b78b81110.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-ecb0c24570c8f20acff8e8d203b2a75b78b81110.png.html">
<link rel="Appendix" title="autogenerated-f5bc9f11881e060d8bfe837373779ba8a3ea21de.png" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=autogenerated-f5bc9f11881e060d8bfe837373779ba8a3ea21de.png.html">
<link rel="Appendix" title="delete.me.to.regenerate.images" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=delete.me.to.regenerate.images.html">
<link rel="Appendix" title="vesta-gui.itk" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=vesta-gui.itk.html">
<link rel="Appendix" title="vesta.itcl" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=vesta.itcl.html">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">

<form id="searchform" method="get" action="ReposUIPackageClass.html">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<div id="logo"><a href="FrontPage.html"><img src="wiki/vesta/img/1line.png" alt="Vesta" height=44 width=202></a></div>
<div id="locationline">

<ul id="pagelocation">
<li><a href="ReposUIPackageClass.html">ReposUIPackageClass</a></li>
</ul>

</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a href="FindPage.html">FindPage</a></li><li class="wikilink"><a href="HelpContents.html">HelpContents</a></li><li class="current"><a href="ReposUIPackageClass.html">ReposUIPackageClass</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="ReposUIPackageClass%3Faction=login.html" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="ReposUIPackageClass.html#Classes">Classes</a><ol><li>
<a href="ReposUIPackageClass.html#Base_class">Base class</a></li><li>
<a href="ReposUIPackageClass.html#VersionContainer_class">VersionContainer class</a></li><li>
<a href="ReposUIPackageClass.html#Session_class">Session class</a></li><li>
<a href="ReposUIPackageClass.html#Package_class">Package class</a></li><li>
<a href="ReposUIPackageClass.html#Branch_class">Branch class</a></li><li>
<a href="ReposUIPackageClass.html#Version_class">Version class</a></li><li>
<a href="ReposUIPackageClass.html#WorkingDir_class">WorkingDir class</a></li><li>
<a href="ReposUIPackageClass.html#Reservation_class">Reservation class</a></li></ol></li><li>
<a href="ReposUIPackageClass.html#Related_Functions">Related Functions</a></li><li>
<a href="ReposUIPackageClass.html#What_about_methods_to_perform_checkout.2C_checkin_etc..3F">What about methods to perform checkout, checkin etc.?</a></li><li>
<a href="ReposUIPackageClass.html#Other_notes">Other notes</a></li><li>
<a href="ReposUIPackageClass.html#Development_Plan">Development Plan</a></li><li>
<a href="ReposUIPackageClass.html#Tricky_Issues">Tricky Issues</a></li><li>
<a href="ReposUIPackageClass.html#Existing_Implementations">Existing Implementations</a></li><li>
<a href="ReposUIPackageClass.html#ReposUIPackage_Implementation_and_Concerns">ReposUIPackage Implementation and Concerns</a><ol><li>
<a href="ReposUIPackageClass.html#Classes_hierarchy">Classes hierarchy</a></li><li>
<a href="ReposUIPackageClass.html#Some_implementation_concerns_that_were_brought_up_previously_and_theirs_current_solutions">Some implementation concerns that were brought up previously and theirs current solutions</a></li><li>
<a href="ReposUIPackageClass.html#SWIG_concerns">SWIG concerns</a></li></ol></li></ol></div> <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867"><a href="ScottVenier.html">ScottVenier</a> and <a href="KenSchalk.html">KenSchalk</a> were talking about the possibility of adding a class to <a href="ReposUI.html">ReposUI</a> to represent a package.  This would provide some higher-level operations than <a href="VestaSource.html">VestaSource</a> and wouldm make it easier to write applications like <a href="VestaWeb.html">VestaWeb</a> (e.g. a GUI).  This page contians some notes on how we could do this. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
<h1 id="Classes">Classes</h1>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">We probably need several classes: <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><ul><li><p class="line891"><strong>Package</strong>: represents a package <span class="anchor" id="line-14"></span></li><li><p class="line891"><strong>Version</strong>: represents an individual version; could be in a package, branch, or session directory <span class="anchor" id="line-15"></span></li><li><p class="line891"><strong>Branch</strong>: derived from <strong>Package</strong> <span class="anchor" id="line-16"></span></li><li><p class="line891"><strong>Session</strong>: represents a <a class="http" href="../vesta/doc/man/html/vesta-intro.1.html#session">session</a> directory <span class="anchor" id="line-17"></span></li><li><p class="line891"><strong>Reservation</strong>: represents a version reservation stub <span class="anchor" id="line-18"></span></li><li><p class="line891"><strong>Version<tt class="backtick"></tt>Container</strong> is simply a base class for both <strong>Package</strong> and <strong>Session</strong> <span class="anchor" id="line-19"></span></li><li><p class="line891"><strong>Working<tt class="backtick"></tt>Dir</strong>: represents a working copy (a mutable direcotry under <tt>/vesta-work</tt>) <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></li></ul><p class="line874">Things that we don't need more classes for: <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><ul><li><p class="line862">Contents of versions (files, sub-directories): <a href="VestaSource.html">VestaSource</a> is good enough <span class="anchor" id="line-24"></span></li><li><p class="line862">Ghosts: a derived class wouldn't have anything to add, so just use <a href="VestaSource.html">VestaSource</a> <span class="anchor" id="line-25"></span></li><li><p class="line862">Latest link: it's not a <strong>Reservation</strong> but it is a stub <span class="anchor" id="line-26"></span></li><li><p class="line862">Generic mutable directories (<tt>/vesta-work/jnsmith</tt>): again, <a href="VestaSource.html">VestaSource</a> is fine <span class="anchor" id="line-27"></span></li><li><p class="line862">Generic appendable directory (<tt>/vesta/vestasys.org</tt>): use <a href="VestaSource.html">VestaSource</a> <span class="anchor" id="line-28"></span></li><li>Volatile directories: only the evaluator uses these <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span></li></ul><p class="line867">
<h2 id="Base_class">Base class</h2>
<span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line874">We probably want a base class for all of these.  Maybe this should be VDirSurrogate, or maybe it should be a new class. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><ul><li><p class="line891"><em>findMaster</em>: finds the master repository for this package. returns another object of the same type which refers to the master copy. <span class="anchor" id="line-35"></span><ul><li><p class="line862">See <a href="ReposUI.html">ReposUI</a>::filenameToMasterVS <span class="anchor" id="line-36"></span></li></ul></li><li><p class="line891"><em>remote</em>: returns a boolean indicating whether this object refers to the local repository or a remote repository <span class="anchor" id="line-37"></span></li><li><p class="line891"><em>isPackage</em>/<em>isBranch</em>/...: determines whether this is one of the other types <span class="anchor" id="line-38"></span><ul><li><p class="line862">Does this simply use RTTI, or <a href="VestaSource.html">VestaSource</a> tests like <tt>inAttribs(&quot;type&quot;,&nbsp;&quot;package&quot;)</tt>? <span class="anchor" id="line-39"></span></li></ul></li><li><p class="line891"><em>castToPackage</em>/<em>castToBranch</em>/...: returns an object of the requested type <span class="anchor" id="line-40"></span></li><li><p class="line891"><em>pathname</em>: returns a Text of the pathname, similar to ReposUI::vsToFilename(). <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></li></ul><p class="line867">
<h2 id="VersionContainer_class">VersionContainer class</h2>
<span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line862">Abstract base class (should never actually be instantiated).  It's concrete sub-classes are <strong>Package</strong>, <strong>Branch</strong>, and <strong>Session</strong>. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line874">Member functions: <span class="anchor" id="line-47"></span><ul><li><p class="line891"><em>versions</em>: returns all the <strong>Version</strong> objects in the package <span class="anchor" id="line-48"></span></li><li><p class="line891"><em>ancestors</em>: returns the <strong>Version</strong> representing what this collection of versions is based on (i.e. the <tt>old-version</tt> attribute (if any) and/or ReposUI::prevVersion of version 0) <span class="anchor" id="line-49"></span></li><li><p class="line891"><em>latest</em>: returns the <strong>Version</strong> representing the highest version in the package <span class="anchor" id="line-50"></span><ul><li><p class="line862">See <a href="ReposUI.html">ReposUI</a>::highver <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></li></ul></li></ul><p class="line874">Other notes: <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><ul><li>Some way to find ghosts? <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></li></ul><p class="line867">
<h2 id="Session_class">Session class</h2>
<span class="anchor" id="line-57"></span><p class="line862">Derived from Version<tt class="backtick"></tt>Container and adds these additional member functions: <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><ul><li><p class="line891"><em>newVersion</em>: returns the <tt>new-version</tt> of the session directory, if any <span class="anchor" id="line-60"></span><ul><li><p class="line862">Returns a <strong>Version</strong> if the session has already been ended by checking in <span class="anchor" id="line-61"></span></li><li><p class="line862">Returns a <strong>Reservation</strong> if the session is still active <span class="anchor" id="line-62"></span></li></ul></li><li><p class="line891"><em>exclusive</em>: returns a boolean indicating whether this was an exclusive checkout (i.e. whether it has a non-empty <tt>new-version</tt> attribute) <span class="anchor" id="line-63"></span></li><li><p class="line891"><em>workingDir</em>(goToMaster=false): returns the <strong>Working<tt class="backtick"></tt>Dir</strong> associated with the session <span class="anchor" id="line-64"></span><ul><li>goToMaster=false means find the working directory in the same repository, goToMaster=true means find the working directory in whatever repository it's in <span class="anchor" id="line-65"></span></li><li><p class="line862">This is a strange case, but we may want a way to differentiate between a session which never had a working directory (i.e. was created with <a class="http" href="../vesta/doc/man/html/vcheckout.1.html#-W">vcheckout -W</a>) from a session which had a working directory but doesn't have one any more (i.e. a session closed by checkin or removal of its working copy). <span class="anchor" id="line-66"></span></li></ul></li><li><p class="line891"><em>ownedBy</em>: returns the owner of this session as a text string <span class="anchor" id="line-67"></span></li><li><p class="line891"><em>ownedByMe</em>: determines whether this session is owned by the user running the program <span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span></li></ul><p class="line867">
<h2 id="Package_class">Package class</h2>
<span class="anchor" id="line-70"></span><p class="line862">Derived from Version<tt class="backtick"></tt>Container and adds these additional member functions: <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><ul><li><p class="line891"><em>branches</em>: returns all the <strong>Branch</strong> objects contained in the package <span class="anchor" id="line-73"></span></li><li><p class="line891"><em>sessions</em>: returns all the <strong>Session</strong> objects contained in the package <span class="anchor" id="line-74"></span></li><li><p class="line891"><em>reservations</em>: returns all the <strong>Reservation</strong> objects contained in the package <span class="anchor" id="line-75"></span></li><li><p class="line891"><em>isCheckedOut</em>: returns a boolean indicating whether the package is currently checked out (i.e. would <tt>vcheckout</tt> fail with &quot;already checked out&quot;)? <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span></li></ul><p class="line867">
<h2 id="Branch_class">Branch class</h2>
<span class="anchor" id="line-78"></span><p class="line874">Derived from Package.  Does it add anything? <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line862">We think we'll keep this because branches may become more interesting in the future.  (See <a href="vupdateandbranches.html">vupdateandbranches</a>.) <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867">
<h2 id="Version_class">Version class</h2>
<span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><ul><li><p class="line891"><em>session</em>: returns the <strong>Session</strong> object for the <tt>session-dir</tt> of this version (if any) <span class="anchor" id="line-85"></span></li><li><p class="line891"><em>content</em>: returns the <strong>Version</strong> object for the <tt>content</tt> of this version (if any) <span class="anchor" id="line-86"></span></li><li><p class="line891"><em>nextBranches</em>: returns all the <em>Branch</em> objects derived from this version <span class="anchor" id="line-87"></span><ul><li><p class="line862">Should use the <tt>next-branches</tt> attribute if present, but should also look for branches in the same package <span class="anchor" id="line-88"></span></li></ul></li><li><p class="line891"><em>nextSessions</em>: returns all the <em>Session</em> objects derived from this version <span class="anchor" id="line-89"></span><ul><li><p class="line862">Should use the <tt>next-sessions</tt> attribute if present, but should also look for sessions in the same package <span class="anchor" id="line-90"></span></li></ul></li><li><p class="line891"><em>nextVersions</em>: returns all the <em>Version</em> objects derived from this version <span class="anchor" id="line-91"></span><ul><li><p class="line862">Should use the <tt>next-versions</tt> attribute if present, but should also look for versions in the same package <span class="anchor" id="line-92"></span></li></ul></li><li><p class="line891"><em>parent</em>: returns the <strong>Session</strong>, <strong>Branch</strong>, or <strong>Package</strong> object which is the parent of this version <span class="anchor" id="line-93"></span></li><li><p class="line891"><em>ancestors</em>: returns some kind of list of <tt>old-version</tt>, ReposUI::prevVersion, and any <tt>merged-with</tt> attributes. <span class="anchor" id="line-94"></span></li><li><p class="line862">?<em>diff</em>: takes some other <strong>Version</strong> and returns the diff against it.  A few issues surrounding this are discussed on <a href="DiffIssues.html">DiffIssues</a>. <span class="anchor" id="line-95"></span><ul><li><p class="line862">Note: <a href="VestaSource.html">VestaSource</a>::list with deltaOnly=true will provide the file/directory changes over the basis version.  We could provide something like this which just tells the caller about the changes on a whole file level without getting into what's discussed on <a href="DiffIssues.html">DiffIssues</a>. <span class="anchor" id="line-96"></span></li></ul></li><li><p class="line891"><em>equalTo</em>/<em>operator==</em>: determines whether two versions are identical <span class="anchor" id="line-97"></span><ul><li><p class="line862">Should return true for a pair of <strong>Version</strong> objects that are in different repositories but have the same path <span class="anchor" id="line-98"></span></li><li>Should return true for a version that refer to the same immutable contents (i.e. have the same fingerprint) such as a version in a package and the snapshot it was created from <span class="anchor" id="line-99"></span></li></ul></li><li><p class="line891"><em>equalContents</em>: returns true if this version has the exact same contents as another version, even if they occured at different points in history <span class="anchor" id="line-100"></span></li><li><p class="line891"><em>inAncestryOf</em>(otherVersion): returns true if this version appears anywhere in the full ancestry graph of otherVersion <span class="anchor" id="line-101"></span><ul><li><p class="line862">Conceptually  &gt; <span class="anchor" id="line-102"></span></li></ul></li><li><p class="line891"><em>higherThan</em>(otherVersion): returns true if this version seems to be later than another version based on a simple name comparison <span class="anchor" id="line-103"></span><ul><li>pkg/N is higherThan pkg/N-1 <span class="anchor" id="line-104"></span></li><li>pkg/checkout/N/M is higherThan pkg/N-1 <span class="anchor" id="line-105"></span></li><li>pkg/N.foo/M is higherThan pkg/N <span class="anchor" id="line-106"></span></li><li><p class="line862">Should use the <a href="VestaWeb.html">VestaWeb</a> compare_versions when they're in the same package <span class="anchor" id="line-107"></span><ul><li>This probably won't work with the word &quot;checkout&quot; (or &quot;scribble&quot;) <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span></li></ul></li></ul></li></ul><p class="line867">
<h2 id="WorkingDir_class">WorkingDir class</h2>
<span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line874">Member functions: <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><ul><li><p class="line891"><em>session</em>: returns the <strong>Session</strong> object for the <tt>session-dir</tt> of this working copy (if any) <span class="anchor" id="line-114"></span></li><li><p class="line891"><em>oldVersion</em>: returns the <strong>Version</strong> representing the <tt>old-version</tt> of this working copy (if any) <span class="anchor" id="line-115"></span></li><li><p class="line891"><em>newVersion</em>: returns the <strong>Reservation</strong> representing the <tt>new-version</tt> of this working copy (if any) <span class="anchor" id="line-116"></span></li><li><p class="line891"><em>exclusive</em>: returns a boolean indicating whether this was an exclusive checkout (i.e. whether it has a non-empty <tt>new-version</tt> attribute) <span class="anchor" id="line-117"></span></li><li><p class="line891"><em>lastSnapshot</em>: returns the <strong>Version</strong> representing the latest snapshot in the associated session directory <span class="anchor" id="line-118"></span></li><li><p class="line891"><em>needSnapshot</em>: returns a boolean indicating whether the working copy has been changed since the last snapshot (i.e. whether vadvance would take a new snapshot) <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span></li></ul><p class="line867">
<h2 id="Reservation_class">Reservation class</h2>
<span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line874">Member functions: <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><ul><li><p class="line891"><em>session</em>: returns the <strong>Session</strong> object for the <tt>session-dir</tt> of this reservation (if any) <span class="anchor" id="line-125"></span></li><li><p class="line891"><em>workingDir</em>(goToMaster=false): returns the <strong>Working<tt class="backtick"></tt>Dir</strong> associated with the reservation (if any) <span class="anchor" id="line-126"></span></li><li><p class="line891"><em>parent</em>: returns the <strong>Branch</strong> or <strong>Package</strong> object which is the parent of this reservation <span class="anchor" id="line-127"></span></li><li><p class="line891"><em>ownedBy</em>: returns the global name of the owner of this reservation (i.e. the <tt>checkout-by</tt> attribute) <span class="anchor" id="line-128"></span></li><li><p class="line891"><em>ownedByMe</em>: determines whether this reservation is owned by the user running the program <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span></li></ul><p class="line867">
<h1 id="Related_Functions">Related Functions</h1>
<span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line862">There should be a function to give a canonical sorted order of the versions and version reservations within a package/branch/session (<strong>Version<tt class="backtick"></tt>Container</strong>) and it's contents(?).  This should include any ghosted versions as well with some indication that they are ghosts. <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line867">
<h1 id="What_about_methods_to_perform_checkout.2C_checkin_etc..3F">What about methods to perform checkout, checkin etc.?</h1>
<span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line874">We've talked before about the idea of turning the command-line tools (vcheckout, vcheckin, vbranch, etc.) into call-able API functions.  However, this not at all a simple task for several reasons: <span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><ul><li>The caller would have to provide some mechanism to specify how messages and errors should be presented to the user.  Ideally this should be flexible enough to allow a GUI to redirect all such output.  Currently the code just sends all this to standard output/standard error as plain text which isn't good enough for a callable version. <span class="anchor" id="line-139"></span></li><li>Many of these commands have an interactive component (message entry).  Again, the caller would have to be able to specify how user interaction would be handled and we'd want this to be flexible enough to allow for a GUI to present questions in a natural way. <span class="anchor" id="line-140"></span></li><li>The commands can be a multi-step process with several long-running pieces.  (For example, vcheckout can involve up to 4 different repository servers.)  The caller should have the option to provide user feedback that a long-running operation is in progress, and should be able to present output about each step as it is completed.  This further complicates the API. <span class="anchor" id="line-141"></span></li><li><p class="line862">The current implementation of these operations probably has resource leaks, since they're short-running programs.  We should use <a class="http" href="http://valgrind.org/">valgrind</a> on the command-line tools first to at least eliminate any memory leaks or other memory problems. <span class="anchor" id="line-142"></span></li><li><p class="line862">Soon we'll have <a class="https" href="https://sourceforge.net/tracker/index.php?func=detail&amp;aid=824562&amp;group_id=34164&amp;atid=410430">triggers for repository changes</a>.  Those are external programs which may expect to print information to the user and/or interact with them, all through their standard input/output/error streams.  To be completely general, this probably means that a GUI would have to provide some sort of a simple terminal interface for the triggers to interact with the user. <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span></li></ul><p class="line874">We do believe that having an API for performing the operations is desirable, but because of these complications we don't think it should be a requirement for the first version of the interface which this page is about.  Simply providing information about the revision control objects in a meaningful way with common code is a good first step. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line867">
<h1 id="Other_notes">Other notes</h1>
<span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><ul><li><p class="line862">These classes all represent objects in the repository.  They should be derived from the <a href="VestaSource.html">VestaSource</a> class.  (Really derived from VDirSurrogate.) <span class="anchor" id="line-149"></span><ul><li><p class="line862">It's worth noting that a <a href="VestaSource.html">VestaSource</a> object is specific to one repository.  That means that each of these objects would be too.  Some programs may want to create some of these objects referring to other repositories (e.g. to inspect the master copy of a package). <span class="anchor" id="line-150"></span></li></ul></li><li><p class="line862">This should, of course, all become part of <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/beta.vestasys.org/vesta/extras/swig">the interfaces wrapped with SWIG</a> <span class="anchor" id="line-151"></span></li><li><p class="line862">How should multiple objects (package versions/branches/sessions) be returned?  A callback like <a href="VestaSource.html">VestaSource</a>::list?  An array/<a class="nonexistent" href="Sequence.html">Sequence</a> of all of them? <span class="anchor" id="line-152"></span><ul><li>Callbacks are probably no an option across SWIG, which suggests that such functions should just return a list of all the objects. <span class="anchor" id="line-153"></span></li></ul></li><li><p class="line862">Some of these functions can return multiple different possible types (e.g. <strong>Version</strong>::<em>parent</em>).  In C++ we could handle this with <a class="http" href="http://www.devx.com/getHelpOn/Article/10202/1954?pf=true">run-time type identification</a>, but handling this with the scripting languages is an important implementation detail. <span class="anchor" id="line-154"></span></li><li><p class="line862">The multiplicity of functions for answering the question &quot;what is this version derived from&quot; (<em>oldVersion</em>, <em>prevVersion</em>, <em>ancestors</em>) is a bit annoying.  This is due in part due to a bug in vcheckin which sets <tt>old-version</tt> incorrectly, and in part to the unknowns around for merges will be recorded.  It would be nice if we could simplify this.  Maybe <em>oldVersion</em> is neccessary and <em>prevVersion</em> could be used in all cases? <span class="anchor" id="line-155"></span></li><li>We'll need some sort of test suite for these new classes. <span class="anchor" id="line-156"></span></li><li><p class="line862">What are the constructor arguments for these obejcts?  A path?  A <a href="VestaSource.html">VestaSource</a>?  Optionally a specific repository server host:port?  What if you want information from the master (<a href="ReposUI.html">ReposUI</a>::filenameToMasterVS)?  What if you just want any copy (<a href="ReposUI.html">ReposUI</a>::filenameToRealVS)? <span class="anchor" id="line-157"></span><ul><li><p class="line891"><a class="nonexistent" href="ScottWeiland.html">ScottWeiland</a> asks: What if I want to find the current working dir of the latest checkout of a package that is not mastered here?  I can get the master info, but then how can I pass that into the api to acquire the session dir that could be remotely located? <span class="anchor" id="line-158"></span></li><li>All of the above options.  In some cases, each of them makes sense. <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span></li></ul></li></ul><p class="line867">
<h1 id="Development_Plan">Development Plan</h1>
<span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><p class="line874">Not important for the initial version: <span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><ul><li><p class="line891"><strong>Version</strong>::<em>diff</em>: too complicated, too many unknowns <span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span></li></ul><p class="line867">
<h1 id="Tricky_Issues">Tricky Issues</h1>
<span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line862">Use iterator classes for looping over multiple objects (<strong>Package</strong>::<em>versions</em>, <strong>Version</strong>::<em>ancestors</em>, etc.).  We think this will work reasonable well across SWIG.  These should be lazy iterators (not doing any work until they have to.) <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line874">Use type identification functions on base class to handle functions that return one of N different types. <span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><p class="line867">
<h1 id="Existing_Implementations">Existing Implementations</h1>
<span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><ul><li><p class="line891"><a href="VestaWeb.html">VestaWeb</a> includes implementations of some pieces of this. <span class="anchor" id="line-175"></span><ul><li><p class="line891"><a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/vesta/extras/vestaweb">Released version in straight Perl</a> <span class="anchor" id="line-176"></span></li><li><p class="line891"><a class="http" href="http://wopr.scooter.cx/~scott/vestaweb/">Re-write using the SWIG interface</a> <span class="anchor" id="line-177"></span></li></ul></li><li><p class="line862">The old Arana-era control panel (which has never been released but could be under the LGPL agreement) included implementations of some of this written in <a class="http" href="http://incrtcl.sourceforge.net/itcl/">incr Tcl</a> using a much older SWIG interface to some of the Vesta APIs.  I've attached the two interesting files: <span class="anchor" id="line-178"></span><ul><li><p class="line891"><a class="attachment" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=vesta.itcl.html" title="">vesta.itcl</a> : most similar to what's described above <span class="anchor" id="line-179"></span></li><li><p class="line891"><a class="attachment" href="ReposUIPackageClass%3Faction=AttachFile&amp;do=view&amp;target=vesta-gui.itk.html" title="">vesta-gui.itk</a> : includes support for creating a menu for selecting one of several versions <span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span></li></ul></li></ul><p class="line867">
<h1 id="ReposUIPackage_Implementation_and_Concerns">ReposUIPackage Implementation and Concerns</h1>
<span class="anchor" id="line-182"></span><p class="line862">Current version of ReposUIPackage: <a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/vesta/repos_ui/36.ReposUIPackage/3">repos_ui/36.ReposUIPackage/3</a>. It also uses  <span class="anchor" id="line-183"></span><a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/vesta/repos/62.ReposUIPackage/1">repos/62.ReposUIPackage/1</a> and <span class="anchor" id="line-184"></span><a class="http" href="http://pub.vestasys.org/cgi-bin/vestaweb?path=/vesta/vestasys.org/basics/os/21.common_parent/1">basics/os/21.common_parent/1</a> <span class="anchor" id="line-185"></span>
<h2 id="Classes_hierarchy">Classes hierarchy</h2>
<span class="anchor" id="line-186"></span><p class="line867"><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><img src="ReposUIPackageClass%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-84cec9f1d96e7f2d9117bd9ada65a4b4bf0ee094.png" /><span class="anchor" id="line-201"></span><p class="line867">
<h2 id="Some_implementation_concerns_that_were_brought_up_previously_and_theirs_current_solutions">Some implementation concerns that were brought up previously and theirs current solutions</h2>
<span class="anchor" id="line-202"></span><ul><li><p class="line862">Classes are derived from V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a>. <span class="anchor" id="line-203"></span><ul><li><p class="line891"><span class="u">Problem description:</span> It has been decided that SourceBase class should inherit from V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a> so higher level interface objects will inherit V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a> functionality. In that case the V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a> constructor is called before we know the VestaSource (V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a>) which this new higher level object is going to represent. Maybe we should define copy constructor in V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a>, call it by SourceBase constructors with <tt>ReposUI::filenameToMasterVS</tt> or <tt>ReposUI::filenameToRealVS</tt> as parameter, but there is another tricky issue of freeing the object returned by those functions. Another possibility is to have V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a> as a member variable in SourceBase class. In that case we’ll need wrappers around V!<a class="nonexistent" href="DirSurrogate.html">DirSurrogate</a> functions in SourceBase class which brings up the maintenance problem.( <a class="http" href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1358636&amp;group_id=34164&amp;atid=410430">tracker entry</a>) <span class="anchor" id="line-204"></span></li><li><p class="line891"><span class="u">Current approach:</span> <tt>VDirSurrogate::copy()</tt> function is used. <span class="anchor" id="line-205"></span></li><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>)</em>: <tt>VDirSurrogate::copy()</tt> should be pretected.  It might also be a good idea to have a protected default constructor (one that takes no arguments) for <tt>VDirSurrogate</tt> which initializes it to a known invalid state <span class="anchor" id="line-206"></span></li></ul></li><li>isPackage/isBranch/... <span class="anchor" id="line-207"></span><ul><li><p class="line891"><span class="u">Current approach:</span> check <tt>SourceBase::source_kind</tt> member variable. <span class="anchor" id="line-208"></span></li><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>)</em>: Consider using <tt>dynamic_cast</tt> here.  It might make <tt>SourceBase::source_kind</tt> unnecessary.  (<a class="http" href="http://www.cplusplus.com/doc/tutorial/typecasting.html">Here's a page that briefly describes dynamic_cast and other c++ type casting features.</a>) <span class="anchor" id="line-209"></span></li></ul></li><li>castToPackage/castToBranch... <span class="anchor" id="line-210"></span><ul><li><p class="line891"><span class="u">Current approach:</span> performs kind chek by calling corresponded is&lt;Kind&gt; function and then performs casting. Returns NULL if is&lt;Kind&gt; returned false. <span class="anchor" id="line-211"></span></li><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>)</em>: Again, consider using <tt>dynamic_cast</tt>. <span class="anchor" id="line-212"></span></li></ul></li><li>ownedBy/ownedByMe <span class="anchor" id="line-213"></span><ul><li><p class="line891"><span class="u">Current approach:</span> simply reads attributes <span class="anchor" id="line-214"></span></li><li><p class="line891"><span class="u">Better solution:</span> should use new AccessCheck SRPC calls once they are implemented. <span class="anchor" id="line-215"></span></li></ul></li><li>How should multiple objects (package versions/branches/sessions) be returned? <span class="anchor" id="line-216"></span><ul><li><p class="line891"><span class="u">Current approach:</span> Enumerators <span class="anchor" id="line-217"></span></li><li><p class="line862">Enumerators that inherit from ContainerEnum (BranchesEnum, VersionsEnum, SessionEnum, ReservationsEnum and GhostsEnum) enumerate only over local objects.  <span class="anchor" id="line-218"></span></li></ul></li></ul><p class="line867"><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><img src="ReposUIPackageClass%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-0f79d505ffddd8b36f914c3a3024432606aaf4c6.png" /><span class="anchor" id="line-230"></span><p class="line867"><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><pre><span class="anchor" id="line-1"></span>BranchesEnum* Package::branches()
<span class="anchor" id="line-2"></span>VersionsEnum* VersionContainer::versions()
<span class="anchor" id="line-3"></span>SessionsEnum* Package::sessions()
<span class="anchor" id="line-4"></span>ReservationsEnum* Package::reservations()
<span class="anchor" id="line-5"></span>GhostsEnum* VersionContainer::ghosts()</pre><span class="anchor" id="line-237"></span><ul><li><p class="line891">AncestorsEnum performs lookup localy and in repositories provided by hints. <span class="anchor" id="line-238"></span></li></ul><p class="line867"><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><img src="ReposUIPackageClass%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-2a107e331ea6364eecfbd1cd4d95fe58d2433f65.png" /><span class="anchor" id="line-244"></span><p class="line867"><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><pre><span class="anchor" id="line-1-1"></span>AncestorsEnum* VersionContainer::ancestors(Text hints = &quot;&quot;)
<span class="anchor" id="line-2-1"></span>AncestorsEnum* Version::ancestors(Text hints = &quot;&quot;)</pre><span class="anchor" id="line-248"></span><ul><li><p class="line862">Enumerators that inherit from EnumBase (NextBranchesEnum, NextVersionsEnum, NextSessionsEnum) enumerate over container entries first and perform attributes based lookups next. If object specified by attribute does not exist localy enum should try to find it in repositories specified by hints.  <span class="anchor" id="line-249"></span></li></ul><p class="line867"><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><img src="ReposUIPackageClass%3Faction=AttachFile&amp;do=get&amp;target=autogenerated-2a5a87a3fc183fd7f5594667e9e31b239e1a0fd5.png" /><span class="anchor" id="line-259"></span><p class="line867"><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><pre><span class="anchor" id="line-1-2"></span>NextBranchesEnum* Version::nextBranches()
<span class="anchor" id="line-2-2"></span>NextVersionsEnum* Version::nextVersions()
<span class="anchor" id="line-3-1"></span>NextSessionsEnum* Version::nextSessions()</pre><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><ul><li>Some way to find ghosts? <span class="anchor" id="line-266"></span><ul><li><p class="line891"><span class="u">Current approach:</span>  <tt>GhostEnum*&nbsp;VersionsContainer::ghosts()</tt> <span class="anchor" id="line-267"></span></li></ul></li><li>The way to differentiate between a session which never had a working directory (i.e. was created with vcheckout -W) from a session which had a working directory but doesn't have one any more (i.e. a session closed by vcheckin or removal of its working copy) <span class="anchor" id="line-268"></span><ul><li><p class="line891"><span class="u">Current approach:</span> <span class="anchor" id="line-269"></span></li></ul></li></ul><p class="line867"><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><pre><span class="anchor" id="line-1-3"></span>// hasWorkDir: returns true if work-dir attribute is set, false otherwise
<span class="anchor" id="line-2-3"></span>// (case vcheckout -W)
<span class="anchor" id="line-3-2"></span>bool hasWorkDirAttrib() throw (SRPC::failure)
<span class="anchor" id="line-4-1"></span>
<span class="anchor" id="line-5-1"></span>// workingDir: returns WorkingDir object if it's an active session, and 
<span class="anchor" id="line-6"></span>// NULL if session is not active or work-dir attribute is not set. 
<span class="anchor" id="line-7"></span>// if go_to_master is false it looks for working directory in the same 
<span class="anchor" id="line-8"></span>// repository, if go_to_master is true it looks for the working directory 
<span class="anchor" id="line-9"></span>// in other repositories. 
<span class="anchor" id="line-10"></span>WorkingDir* workingDir(bool go_to_master = false)
<span class="anchor" id="line-11"></span>      throw (ReposUI::failure, VestaConfig::failure, SRPC::failure);</pre><span class="anchor" id="line-282"></span><ul><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>)</em>: The description of <tt>workingDir</tt> seems a little strange.  There is only ever one repository in which the working directory for a session directory exists.  Saying that it &quot;looks ... in other repositories&quot; makes it sound like it's searching multiple repositories which doesn't make sense. <span class="anchor" id="line-283"></span></li><li>Fixed version: <span class="anchor" id="line-284"></span></li></ul><p class="line867"><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><pre><span class="anchor" id="line-1-4"></span>   // hasWorkDir: returns true if work-dir attribute is set, false otherwise
<span class="anchor" id="line-2-4"></span>    // (case vcheckout -W)
<span class="anchor" id="line-3-3"></span>    bool hasWorkDirAttrib() throw (SRPC::failure)
<span class="anchor" id="line-4-2"></span>    { return isAttribSet(&quot;work-dir&quot;); }
<span class="anchor" id="line-5-2"></span>    
<span class="anchor" id="line-6-1"></span>    // workingDir: returns WorkingDir object if it's an active session, and 
<span class="anchor" id="line-7-1"></span>    // NULL if session is not active or work-dir attribute is not set. 
<span class="anchor" id="line-8-1"></span>    // If go_to_master is false the work dir is only looked up in local 
<span class="anchor" id="line-9-1"></span>    // repository. if go_to_master is true then master copy of the 
<span class="anchor" id="line-10-1"></span>    // session is looked up and working dir is looked up in the repository 
<span class="anchor" id="line-11-1"></span>    // where session's master copy was found.   
<span class="anchor" id="line-12"></span>    WorkingDir* workingDir(bool go_to_master = false)
<span class="anchor" id="line-13"></span>      throw (ReposUI::failure, VestaConfig::failure, SRPC::failure);</pre><span class="anchor" id="line-299"></span><ul><li>sortContents: <span class="anchor" id="line-300"></span><ul><li><p class="line891"><span class="u">Current approach:</span> Not only versions, reservations and ghosts, but also branches and packages are sorted (<tt>VersionContainer::sortContents</tt>). <span class="anchor" id="line-301"></span></li><li><p class="line891"><em>(<a href="KenSchalk.html">KenSchalk</a>)</em>: As far as I can see, &quot;<tt>sortContents</tt>&quot; doesn't occur in repos_ui/36.ReposUIPackage/3 <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span></li></ul></li></ul><p class="line867">
<h2 id="SWIG_concerns">SWIG concerns</h2>
<span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><ul><li><p class="line862">Cases where the scripting language has two different pointers to the same heap-allocated C++ object may be a problem for memory management.  Specifically it could result in a double-free or a use-after-free if the scripting language doesn't know that the two pointers are the same.  For example, using <tt>Package::sortContents</tt> or <tt>Session::NewVersion</tt> and then using the casting functions (<tt>castToVersion</tt>, <tt>castToBranch</tt>, <tt>castToReservation</tt>) could create this situation. <span class="anchor" id="line-306"></span><ul><li>We're pretty sure this is a problem in Perl, it may not be in Tcl where objects must be explicitly destroyed.  We're not sure about Python and Java though we expect problems there as well. <span class="anchor" id="line-307"></span></li><li>Instead of the casting functions returning the same object, we could have them copy, but this would be bad for C++ so maybe we should do it in the SWIG wrappers.  We might want to change the names of the functions to clarify that they're doing more than just casting to a different class. <span class="anchor" id="line-308"></span></li></ul></ul><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

